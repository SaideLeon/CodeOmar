Conteúdo coletado do arquivo: codeomar.zip
Filtrando por extensões: .txt, .md, .js, .ts, .tsx, .json, .css, .html

========================================
Arquivo: metadata.json
========================================

{
  "name": "CodeOmar",
  "description": "A high-performance, dark-mode blog for software engineers featuring neon aesthetics, deep-dive technical content, and AI-powered insights.",
  "requestFramePermissions": []
}

========================================
Arquivo: types.ts
========================================

export interface BlogPost {
  id: string;
  title: string;
  excerpt: string;
  category: string;
  subcategory?: string; // Added optional subcategory
  readTime: string; // Mapped from 'read_time' in DB
  date: string;     // Mapped from 'created_at' or 'published_at'
  content?: string; // Markdown content
  tags: string[];
  slug: string;     // Added slug
  status: 'draft' | 'published';
}

export interface Category {
  id: string;
  name: string;
  description: string;
}

export type ViewState = 'HOME' | 'ARTICLE' | 'SEARCH' | 'SUBSCRIBE' | 'ABOUT' | 'ADMIN';

export interface UserProfile {
  id: string;
  username: string;
  avatar_url: string;
  role: 'user' | 'admin';
}

========================================
Arquivo: constants.ts
========================================

import { BlogPost, Category } from './types';

export const CATEGORIES: Category[] = [
  { id: 'backend', name: 'Arq. Backend', description: 'Escalabilidade, Sistemas Distribuídos e Banco de Dados' },
  { id: 'frontend', name: 'Eng. Frontend', description: 'Internals do React, Gerenciamento de Estado e UI/UX' },
  { id: 'devops', name: 'DevOps & CI/CD', description: 'Infraestrutura como Código, Kubernetes e Observabilidade' },
  { id: 'soft-skills', name: 'Soft Skills', description: 'Crescimento de carreira, Mentoria e Liderança' },
  { id: 'ai-ml', name: 'IA Aplicada', description: 'LLMs, RAG e integração de IA em apps' },
];

export const INITIAL_POSTS: BlogPost[] = [
  {
    id: '1',
    title: 'O Mito do "Código Limpo": Quando a Abstração Vira Dívida',
    excerpt: 'Clean Code é religião para muitos, mas o excesso de DRY pode tornar sua codebase ilegível. Vamos discutir pragmatismo sobre dogmatismo.',
    category: 'Soft Skills',
    readTime: '6 min leitura',
    date: '24/10/2023',
    tags: ['Boas Práticas', 'Refatoração', 'Arquitetura'],
    slug: 'mito-codigo-limpo',
    status: 'published',
    content: `
# O Mito do "Código Limpo"

Todos nós já estivemos lá. Você lê o livro do Uncle Bob, sente a iluminação divina e começa a refatorar cada função para ter no máximo 4 linhas. Uma semana depois, ninguém entende o fluxo de execução.

## A falácia do DRY (Don't Repeat Yourself)

O princípio DRY é valioso, mas a duplicação acidental é muitas vezes preferível à abstração errada.

\`\`\`typescript
// Abstração prematura
function handleUser(u: User, action: string) {
  // 50 if/else cases baseados na action
}
\`\`\`

Às vezes, copiar e colar um bloco de 3 linhas é melhor do que criar uma função genérica que aceita 12 parâmetros opcionais.

## Contexto é Rei

Código limpo não é sobre regras estáticas; é sobre clareza no contexto da equipe atual.
    `
  },
  {
    id: '2',
    title: 'Entendendo o React Fiber: O Que Acontece no Render?',
    excerpt: 'Mergulhando fundo no algoritmo de reconciliação do React. Como a árvore de trabalho assíncrona funciona de verdade.',
    category: 'Eng. Frontend',
    readTime: '12 min leitura',
    date: '26/10/2023',
    tags: ['React', 'Performance', 'Internals'],
    slug: 'entendendo-react-fiber',
    status: 'published',
  },
  {
    id: '3',
    title: 'Kubernetes para Devs: Você Não Precisa Ser SRE',
    excerpt: 'Conceitos fundamentais de K8s que todo desenvolvedor backend deveria saber para parar de dizer "funciona na minha máquina".',
    category: 'DevOps & CI/CD',
    readTime: '8 min leitura',
    date: '28/10/2023',
    tags: ['K8s', 'Docker', 'Infraestrutura'],
    slug: 'kubernetes-para-devs',
    status: 'published',
  },
  {
    id: '4',
    title: 'System Design: Projetando um Clone do Twitter',
    excerpt: 'Um guia passo-a-passo sobre sharding de banco de dados, fan-out on write vs fan-out on load e caching strategies.',
    category: 'Arq. Backend',
    readTime: '15 min leitura',
    date: '30/10/2023',
    tags: ['System Design', 'Escalabilidade', 'Bancos de Dados'],
    slug: 'system-design-twitter-clone',
    status: 'published',
  },
  {
    id: '5',
    title: 'Rust vs Go: Qual Escolher para Microsserviços em 2024?',
    excerpt: 'Uma análise sem fanatismo. Performance, developer experience e ecossistema. Quando a segurança de memória do Rust vale a pena?',
    category: 'Arq. Backend',
    readTime: '10 min leitura',
    date: '02/11/2023',
    tags: ['Rust', 'Go', 'Microsserviços'],
    slug: 'rust-vs-go-microservicos',
    status: 'published',
  },
  {
    id: '6',
    title: 'A Arte do Code Review Empático',
    excerpt: 'Como apontar erros sem destruir a confiança do seu colega. Técnicas para reviews mais rápidos e eficientes.',
    category: 'Soft Skills',
    readTime: '5 min leitura',
    date: '05/11/2023',
    tags: ['Cultura', 'Trabalho em Equipe', 'Comunicação'],
    slug: 'arte-code-review-empatico',
    status: 'published',
  },
  {
    id: '7',
    title: 'RAG (Retrieval-Augmented Generation) com LangChain',
    excerpt: 'Implementando um chatbot que realmente conhece sua documentação interna. Vetores, embeddings e contexto window.',
    category: 'IA Aplicada',
    readTime: '14 min leitura',
    date: '08/11/2023',
    tags: ['IA', 'LLM', 'Python'],
    slug: 'rag-langchain-chatbot',
    status: 'published',
  },
  {
    id: '8',
    title: 'CSS Moderno: Diga Adeus aos Media Queries?',
    excerpt: 'Container Queries, :has(), e subgrid mudaram o jogo. Como criar layouts intrinsecamente responsivos.',
    category: 'Eng. Frontend',
    readTime: '7 min leitura',
    date: '10/11/2023',
    tags: ['CSS', 'Design', 'Responsividade'],
    slug: 'css-moderno-container-queries',
    status: 'published',
  },
  {
    id: '9',
    title: 'Monitoramento vs Observabilidade: Qual a Diferença?',
    excerpt: 'Logs, métricas e tracing. Como debugar sistemas distribuídos quando você não sabe o que quebrou.',
    category: 'DevOps & CI/CD',
    readTime: '9 min leitura',
    date: '12/11/2023',
    tags: ['Observabilidade', 'Tracing', 'Debugging'],
    slug: 'monitoramento-vs-observabilidade',
    status: 'published',
  },
  {
    id: '10',
    title: 'Síndrome do Impostor: O Bug Que Afeta Seniors',
    excerpt: 'Por que quanto mais você sabe, mais sente que não sabe nada. Relatos pessoais e estratégias de enfrentamento.',
    category: 'Soft Skills',
    readTime: '6 min leitura',
    date: '15/11/2023',
    tags: ['Carreira', 'Saúde Mental', 'Crescimento'],
    slug: 'sindrome-do-impostor',
    status: 'published',
  },
  {
    id: '11',
    title: 'Escalando Django: Otimizações para Alta Performance',
    excerpt: 'Django é lento? Não se você souber usar. Caching avançado, queries otimizadas com select_related e uso de Celery.',
    category: 'Arq. Backend',
    readTime: '11 min leitura',
    date: '18/11/2023',
    tags: ['Python', 'Django', 'Backend', 'Performance'],
    slug: 'escalando-django-performance',
    status: 'published',
  },
];

========================================
Arquivo: services/geminiService.ts
========================================

import { GoogleGenAI, Type } from "@google/genai";
import { config, hasApiKey } from "./config";

// Initialize Gemini safely inside functions to prevent crash on load if key is missing

const getAiClient = () => {
  const apiKey = config.API_KEY;
  if (!apiKey) {
    throw new Error("API Key not configured");
  }
  return new GoogleGenAI({ apiKey });
};

export const generateArticleContent = async (title: string, excerpt: string): Promise<string> => {
  if (!hasApiKey()) {
    return `# Missing API Key\n\nPlease configure your API_KEY to generate content for: ${title}`;
  }

  try {
    const ai = getAiClient();
    const model = 'gemini-3-flash-preview';
    const prompt = `
      Escreva um artigo técnico completo de blog para programadores sobre o tema: "${title}".
      Contexto: ${excerpt}
      
      Diretrizes:
      - IDIOMA: PORTUGUÊS (BRASIL).
      - Use formato Markdown válido e bem estruturado.
      - Tom: Educativo, profissional mas levemente informal ("de dev para dev").
      - Use subtítulos (H2, H3) frequentes para quebrar o texto.
      - Evite parágrafos muito longos ou blocos densos de texto. O texto deve ser arejado e coeso.
      - Inclua exemplos de código (snippets) onde apropriado (use blocos de código com linguagem especificada).
      - Termine com uma conclusão inspiradora.
    `;

    const response = await ai.models.generateContent({
      model,
      contents: prompt,
    });

    return response.text || "Erro ao gerar conteúdo.";
  } catch (error) {
    console.error("Gemini API Error:", error);
    return `Error generating content: ${(error as Error).message}. \n\n Please try again later.`;
  }
};

export const generateSearchInsights = async (query: string): Promise<string> => {
   if (!hasApiKey()) return "";
   
   try {
     const ai = getAiClient();
     const response = await ai.models.generateContent({
       model: 'gemini-3-flash-preview',
       contents: `User search query on a dev blog: "${query}". Provide a 1-sentence technical insight or "did you know" related to this query. Keep it geeky. Language: Portuguese (Brazil).`,
     });
     return response.text || "";
   } catch (e) {
     return "";
   }
}

export const generateFullPost = async (topic: string): Promise<any> => {
  if (!hasApiKey()) throw new Error("API Key missing");

  const prompt = `
    You are a Senior Staff Engineer writing for a technical blog.
    Generate a complete blog post metadata and content about: "${topic}".
    
    Content Guidelines:
    - LANGUAGE: PORTUGUESE (BRAZIL).
    - The content MUST be deep, technical, and include code snippets.
    - Format in VALID Markdown.
    - Structure the content cohesively: Use clear Headings, short paragraphs, and bullet points to avoid large walls of text.
    - Ensure code blocks are properly fenced.
  `;

  try {
    const ai = getAiClient();
    const response = await ai.models.generateContent({
      model: 'gemini-3-flash-preview',
      contents: prompt,
      config: {
        responseMimeType: "application/json",
        responseSchema: {
          type: Type.OBJECT,
          properties: {
            title: { type: Type.STRING },
            slug: { type: Type.STRING },
            excerpt: { type: Type.STRING },
            content: { type: Type.STRING },
            category: { type: Type.STRING },
            tags: { 
              type: Type.ARRAY, 
              items: { type: Type.STRING } 
            },
            read_time: { type: Type.STRING }
          },
          required: ["title", "slug", "excerpt", "content", "category", "tags", "read_time"]
        }
      }
    });

    let text = response.text || "{}";
    
    // Sanitize: remove any potential markdown code blocks wrapping the JSON if they exist
    text = text.trim();
    if (text.startsWith('```json')) {
      text = text.replace(/^```json/, '').replace(/```$/, '');
    } else if (text.startsWith('```')) {
       text = text.replace(/^```/, '').replace(/```$/, '');
    }
    
    return JSON.parse(text);
  } catch (error) {
    console.error("Gemini Gen Error:", error);
    throw error;
  }
}

========================================
Arquivo: components/GridBackground.tsx
========================================

import React from 'react';

const GridBackground: React.FC = () => {
  return (
    <div className="fixed inset-0 z-0 pointer-events-none overflow-hidden bg-gray-50 dark:bg-[#050505] transition-colors duration-500">
      {/* Grid Pattern */}
      <div 
        className="absolute inset-0 opacity-[0.03] dark:opacity-20 transition-opacity duration-500"
        style={{
          backgroundImage: `linear-gradient(#1f2937 1px, transparent 1px), linear-gradient(90deg, #1f2937 1px, transparent 1px)`,
          backgroundSize: '40px 40px'
        }}
      ></div>
      
      {/* Radial Gradient for spotlight effect */}
      <div className="absolute inset-0 bg-[radial-gradient(circle_800px_at_50%_200px,rgba(16,185,129,0.05),transparent)] dark:bg-[radial-gradient(circle_800px_at_50%_200px,#10b98115,transparent)] transition-all duration-500"></div>
    </div>
  );
};

export default GridBackground;

========================================
Arquivo: components/WindowFrame.tsx
========================================

import React from 'react';

interface WindowFrameProps {
  children: React.ReactNode;
  className?: string;
  title?: string;
  active?: boolean;
}

const WindowFrame: React.FC<WindowFrameProps> = ({ children, className = '', title, active = false }) => {
  return (
    <div className={`relative group ${className}`}>
      {/* Neon Glow effect underneath - subtler in light mode */}
      <div className={`absolute -inset-0.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-lg blur opacity-0 dark:opacity-10 group-hover:opacity-20 dark:group-hover:opacity-30 transition duration-500 ${active ? 'opacity-30 dark:opacity-40' : ''}`}></div>
      
      {/* Main Container */}
      <div className="relative h-full bg-white/80 dark:bg-[#0b0e11]/90 backdrop-blur-md border border-gray-200 dark:border-emerald-500/30 rounded-lg flex flex-col overflow-hidden shadow-xl dark:shadow-none transition-colors duration-300">
        
        {/* Title Bar */}
        <div className="h-8 border-b border-gray-200 dark:border-emerald-500/20 flex items-center px-3 space-x-2 bg-gray-50/80 dark:bg-[#050505]/50 transition-colors duration-300">
          <div className="flex space-x-1.5">
            <div className="w-2.5 h-2.5 rounded-full bg-red-500/80"></div>
            <div className="w-2.5 h-2.5 rounded-full bg-yellow-500/80"></div>
            <div className="w-2.5 h-2.5 rounded-full bg-green-500/80"></div>
          </div>
          {title && (
            <span className="ml-3 text-xs font-mono text-gray-500 dark:text-emerald-500/70 truncate uppercase tracking-wider">
              {title}
            </span>
          )}
        </div>

        {/* Content */}
        <div className="flex-1 overflow-auto p-4 custom-scrollbar">
          {children}
        </div>
      </div>
    </div>
  );
};

export default WindowFrame;

========================================
Arquivo: components/Hero.tsx
========================================

import React from 'react';
import { motion } from 'framer-motion';
import { Terminal, Code, Cpu, ChevronRight } from 'lucide-react';
import WindowFrame from './WindowFrame';

interface HeroProps {
  onSubscribe: () => void;
}

const Hero: React.FC<HeroProps> = ({ onSubscribe }) => {
  return (
    <section className="relative z-10 pt-20 pb-16 md:pt-32 md:pb-24 px-4 overflow-hidden">
      <div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        
        {/* Left: Text Content */}
        <div className="space-y-6 text-center lg:text-left">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
          >
            <span className="inline-block py-1 px-3 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-600 dark:text-emerald-400 text-xs font-mono mb-4">
              v2.0.4 :: LANÇADO
            </span>
            <h1 className="text-5xl md:text-7xl font-bold tracking-tight text-gray-900 dark:text-white mb-2 font-sans transition-colors duration-300">
              Code<span className="text-emerald-600 dark:text-emerald-500">Omar</span>
            </h1>
            <p className="text-xl text-gray-600 dark:text-gray-400 max-w-lg mx-auto lg:mx-0 font-light transition-colors duration-300">
              Descodificando a complexidade do software. Um blog para engenheiros que preferem código a reuniões.
            </p>
          </motion.div>

          <motion.div 
            className="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.2, duration: 0.5 }}
          >
            <button className="px-6 py-3 bg-emerald-500 text-white dark:text-black font-bold rounded hover:bg-emerald-600 dark:hover:bg-emerald-400 transition-colors flex items-center justify-center gap-2 shadow-lg dark:shadow-none">
              <Terminal size={18} />
              Ler Recentes
            </button>
            <button 
              onClick={onSubscribe}
              className="px-6 py-3 border border-emerald-500/50 text-emerald-600 dark:text-emerald-500 rounded hover:bg-emerald-50 dark:hover:bg-emerald-500/10 transition-colors flex items-center justify-center gap-2"
            >
              <Code size={18} />
              Assinar
            </button>
          </motion.div>
        </div>

        {/* Right: Visual Animation (Stacking Windows) */}
        <div className="relative h-[400px] w-full hidden md:block perspective-1000">
          {/* Back Window */}
          <motion.div
             className="absolute top-0 right-0 w-3/4 h-64 z-10"
             initial={{ x: 100, y: -50, opacity: 0 }}
             animate={{ x: 40, y: -40, opacity: 0.4 }}
             transition={{ duration: 1, delay: 0.1 }}
          >
            <WindowFrame title="servico_backend.go" className="h-full w-full opacity-50">
                <div className="space-y-2 font-mono text-xs text-emerald-700 dark:text-emerald-700">
                  <div className="h-2 w-1/3 bg-emerald-900/10 dark:bg-emerald-900/30 rounded"></div>
                  <div className="h-2 w-2/3 bg-emerald-900/10 dark:bg-emerald-900/30 rounded"></div>
                  <div className="h-2 w-1/2 bg-emerald-900/10 dark:bg-emerald-900/30 rounded"></div>
                </div>
            </WindowFrame>
          </motion.div>

          {/* Middle Window */}
          <motion.div
             className="absolute top-12 right-12 w-3/4 h-64 z-20"
             initial={{ x: 100, y: -20, opacity: 0 }}
             animate={{ x: 20, y: -20, opacity: 0.7 }}
             transition={{ duration: 1, delay: 0.3 }}
          >
            <WindowFrame title="schema.graphql" className="h-full w-full">
                <div className="space-y-2 font-mono text-xs text-emerald-700 dark:text-emerald-600">
                  <div className="flex gap-2"><span className="text-pink-600 dark:text-pink-500">type</span> Usuario <span className="text-yellow-600 dark:text-yellow-500">{`{`}</span></div>
                  <div className="pl-4 text-emerald-600 dark:text-emerald-500">id: ID!</div>
                  <div className="pl-4 text-emerald-600 dark:text-emerald-500">nome: String!</div>
                  <div className="text-yellow-600 dark:text-yellow-500">{`}`}</div>
                </div>
            </WindowFrame>
          </motion.div>

          {/* Front Window */}
          <motion.div
             className="absolute top-24 right-24 w-3/4 h-72 z-30"
             initial={{ x: 100, y: 50, opacity: 0 }}
             animate={{ x: 0, y: 0, opacity: 1 }}
             transition={{ duration: 1, delay: 0.5 }}
          >
             <WindowFrame title="App.tsx" className="h-full w-full shadow-2xl dark:shadow-[0_0_50px_rgba(16,185,129,0.2)]">
                <div className="space-y-2 font-mono text-sm">
                   <div className="flex items-center gap-2 text-gray-500 dark:text-gray-400">
                     <span className="text-purple-600 dark:text-purple-400">import</span> React <span className="text-purple-600 dark:text-purple-400">from</span> 'react';
                   </div>
                   <div className="flex items-center gap-2 text-gray-500 dark:text-gray-400">
                     <span className="text-blue-600 dark:text-blue-400">const</span> Blog <span className="text-blue-600 dark:text-blue-400">=</span> () <span className="text-blue-600 dark:text-blue-400">=&gt;</span> <span className="text-yellow-600 dark:text-yellow-400">{`{`}</span>
                   </div>
                   <div className="pl-4 text-gray-500 dark:text-gray-400">
                     <span className="text-purple-600 dark:text-purple-400">return</span> (
                   </div>
                   <div className="pl-8 text-emerald-600 dark:text-emerald-400">
                     &lt;CodeOmar /&gt;
                   </div>
                   <div className="pl-4 text-gray-500 dark:text-gray-400">);</div>
                   <div className="text-yellow-600 dark:text-yellow-400">{`}`}</div>
                   
                   <div className="mt-8 p-3 bg-emerald-50 dark:bg-emerald-500/10 rounded border border-emerald-500/20 flex items-center gap-3">
                     <div className="p-1 bg-emerald-500 rounded text-white dark:text-black"><Cpu size={16} /></div>
                     <span className="text-emerald-700 dark:text-emerald-300 text-xs">Compilando... 400ms</span>
                   </div>
                </div>
             </WindowFrame>
          </motion.div>
        </div>
      </div>
    </section>
  );
};

export default Hero;

========================================
Arquivo: components/SubscribeView.tsx
========================================

import React, { useState } from 'react';
import WindowFrame from './WindowFrame';
import { Mail, Terminal, CheckCircle, ArrowRight, Loader, Code2 } from 'lucide-react';

const SubscribeView: React.FC = () => {
  const [email, setEmail] = useState('');
  const [status, setStatus] = useState<'IDLE' | 'LOADING' | 'SUCCESS'>('IDLE');

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if(!email) return;
    setStatus('LOADING');
    // Simulate API call
    setTimeout(() => {
      setStatus('SUCCESS');
    }, 1500);
  };

  return (
    <div className="max-w-5xl mx-auto px-4 py-12">
        <div className="mb-8 flex items-center gap-2 text-gray-500 font-mono text-sm">
            <span>root</span>
            <span>/</span>
            <span className="text-emerald-600 dark:text-emerald-500">etc</span>
            <span>/</span>
            <span>config_newsletter</span>
        </div>

        <WindowFrame title="inscricao.sh" className="min-h-[500px] flex flex-col md:flex-row shadow-2xl">
            {/* Left Panel: Pitch */}
            <div className="md:w-5/12 p-8 md:p-10 border-b md:border-b-0 md:border-r border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-[#0c0c0c] relative overflow-hidden transition-colors duration-300">
                {/* Background decorative elements */}
                <div className="absolute top-0 right-0 p-4 opacity-5 dark:opacity-5 text-black dark:text-white">
                    <Code2 size={120} />
                </div>

                <div className="relative z-10">
                    <div className="inline-block px-3 py-1 mb-6 rounded-full bg-emerald-500/10 border border-emerald-500/20">
                        <span className="text-emerald-600 dark:text-emerald-400 font-mono text-xs">#!/bin/bash</span>
                    </div>
                    
                    <h2 className="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-6 tracking-tight transition-colors duration-300">
                        Inicializar<br/>
                        <span className="text-emerald-600 dark:text-emerald-500">Stream</span> de<br/>
                        Conhecimento
                    </h2>
                    
                    <p className="text-gray-600 dark:text-gray-400 leading-relaxed mb-8 font-light transition-colors duration-300">
                        Junte-se a mais de 10.000 engenheiros recebendo análises profundas de arquitetura, dicas de otimização e algoritmos de carreira.
                    </p>
                    
                    <div className="space-y-4">
                        {[
                            'Desafios semanais de System Design',
                            'Dicas de performance React & Backend',
                            'Soft-skills para engenharia sênior',
                            'Zero spam, apenas código puro'
                        ].map((item, i) => (
                            <div key={i} className="flex items-start gap-3 text-sm text-gray-700 dark:text-gray-300 font-mono group">
                                <span className="text-emerald-500 mt-0.5 group-hover:scale-110 transition-transform">
                                    <CheckCircle size={16} />
                                </span>
                                <span>{item}</span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>

            {/* Right Panel: Form */}
            <div className="md:w-7/12 p-8 md:p-12 flex flex-col justify-center bg-white dark:bg-[#0b0e11] transition-colors duration-300">
                {status === 'SUCCESS' ? (
                     <div className="text-center space-y-6 animate-in fade-in zoom-in duration-300 py-8">
                        <div className="w-20 h-20 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto text-emerald-600 dark:text-emerald-500 border border-emerald-500/20 shadow-[0_0_30px_rgba(16,185,129,0.2)]">
                            <CheckCircle size={40} />
                        </div>
                        <div>
                            <h3 className="text-2xl font-bold text-gray-900 dark:text-white mb-2">Inscrição Ativa</h3>
                            <p className="text-gray-600 dark:text-gray-400 text-sm font-mono">Target: <span className="text-emerald-600 dark:text-emerald-400">{email}</span></p>
                        </div>
                        
                        <div className="max-w-sm mx-auto p-4 bg-gray-50 dark:bg-black/40 rounded-lg border border-gray-200 dark:border-emerald-500/20 font-mono text-xs text-left text-emerald-700 dark:text-emerald-500/70 mt-4 shadow-inner">
                            <p className="mb-1"><span className="text-gray-500 dark:text-gray-600">admin@codeomar:~$</span> ./verificar_email.sh</p>
                            <p className="text-gray-500 dark:text-gray-400">> estabelecendo conexão... OK</p>
                            <p className="text-gray-500 dark:text-gray-400">> registrando webhook... OK</p>
                            <p className="text-emerald-600 dark:text-emerald-400">> enviando pacote_boas_vindas.json... ENVIADO</p>
                        </div>
                     </div>
                ) : (
                    <form onSubmit={handleSubmit} className="space-y-8 max-w-sm mx-auto w-full">
                        <div className="space-y-4">
                            <div>
                                <label className="block text-xs font-mono text-gray-500 mb-2 uppercase tracking-widest">
                                    // Digite seu email
                                </label>
                                <div className="text-sm font-mono text-emerald-600 dark:text-emerald-500 mb-1">
                                    const subscriber = <span className="text-yellow-600 dark:text-yellow-500">{'{'}</span>
                                </div>
                                <div className="pl-4 border-l-2 border-gray-200 dark:border-gray-800 hover:border-emerald-500/50 transition-colors">
                                    <div className="relative group">
                                        <div className="absolute left-3 top-3 text-gray-400 dark:text-gray-600 flex items-center gap-2 font-mono text-sm pointer-events-none">
                                            email: 
                                        </div>
                                        <input 
                                            type="email" 
                                            required
                                            className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-300 dark:border-gray-700 rounded-lg py-2.5 pl-20 pr-4 text-emerald-900 dark:text-emerald-100 font-mono placeholder-gray-400 dark:placeholder-gray-700 focus:outline-none focus:border-emerald-500/50 focus:bg-white dark:focus:bg-[#1a1f24] transition-all shadow-sm dark:shadow-none"
                                            placeholder="'dev@code.omar'"
                                            value={email}
                                            onChange={(e) => setEmail(e.target.value)}
                                            disabled={status === 'LOADING'}
                                        />
                                    </div>
                                </div>
                                <div className="text-sm font-mono text-yellow-600 dark:text-yellow-500 mt-1">
                                    {'}'}
                                </div>
                            </div>
                        </div>

                        <button 
                            type="submit" 
                            disabled={status === 'LOADING'}
                            className="w-full bg-emerald-600 hover:bg-emerald-500 text-white dark:text-black font-bold py-3.5 rounded-lg flex items-center justify-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed group shadow-[0_4px_14px_0_rgba(5,150,105,0.39)] hover:shadow-[0_6px_20px_rgba(5,150,105,0.23)] dark:shadow-[0_0_20px_rgba(5,150,105,0.3)] dark:hover:shadow-[0_0_30px_rgba(5,150,105,0.5)]"
                        >
                            {status === 'LOADING' ? (
                                <>
                                    <Loader className="animate-spin" size={18} />
                                    <span>Processando...</span>
                                </>
                            ) : (
                                <>
                                    <Terminal size={18} />
                                    <span>Executar Inscrição</span>
                                    <ArrowRight size={16} className="group-hover:translate-x-1 transition-transform" />
                                </>
                            )}
                        </button>
                        
                        <p className="text-[10px] text-gray-500 dark:text-gray-600 text-center font-mono uppercase tracking-widest">
                            Conexão Segura • Criptografia TLS
                        </p>
                    </form>
                )}
            </div>
        </WindowFrame>
    </div>
  );
};

export default SubscribeView;

========================================
Arquivo: components/AboutView.tsx
========================================

import React from 'react';
import WindowFrame from './WindowFrame';
import { Terminal, Cpu, Globe, Coffee, MapPin, Briefcase, Clock, Heart } from 'lucide-react';

const AboutView: React.FC = () => {
  return (
    <div className="max-w-4xl mx-auto px-4 py-12">
      <div className="mb-8 flex items-center gap-2 text-gray-500 font-mono text-sm">
        <span>root</span>
        <span>/</span>
        <span className="text-emerald-600 dark:text-emerald-500">usr</span>
        <span>/</span>
        <span>bin</span>
        <span>/</span>
        <span>whoami</span>
      </div>

      <WindowFrame title="dados_perfil.json" className="shadow-2xl">
        <div className="p-8 md:p-12 bg-white dark:bg-[#0b0e11] transition-colors duration-300">
          
          <div className="flex flex-col md:flex-row gap-12">
            {/* Left Column: Avatar & Quick Stats */}
            <div className="md:w-1/3 flex flex-col items-center text-center">
              <div className="w-40 h-40 rounded-full bg-gradient-to-br from-emerald-400 to-cyan-600 p-1 mb-6 shadow-xl relative group">
                <div className="w-full h-full rounded-full bg-gray-100 dark:bg-gray-900 flex items-center justify-center overflow-hidden relative">
                   {/* Placeholder Avatar */}
                   <Terminal size={64} className="text-gray-400 dark:text-gray-600 group-hover:scale-110 transition-transform duration-500" />
                </div>
                <div className="absolute bottom-2 right-2 w-8 h-8 bg-emerald-500 border-4 border-white dark:border-[#0b0e11] rounded-full shadow-lg" title="Status: Online"></div>
              </div>
              
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-2">Saíde Omar Saíde</h2>
              <p className="text-emerald-600 dark:text-emerald-500 font-mono text-sm mb-6">&lt;Dev FullStack /&gt;</p>
              
              <div className="w-full space-y-3 font-mono text-xs">
                 <div className="flex justify-between items-center p-2.5 bg-gray-50 dark:bg-gray-800/30 rounded border border-gray-200 dark:border-gray-800 hover:border-emerald-500/30 transition-colors">
                    <span className="text-gray-500 flex items-center gap-2"><MapPin size={12}/> Localização</span>
                    <span className="text-gray-700 dark:text-gray-300 font-semibold">Quelimane, MZ</span>
                 </div>
                 <div className="flex justify-between items-center p-2.5 bg-gray-50 dark:bg-gray-800/30 rounded border border-gray-200 dark:border-gray-800 hover:border-emerald-500/30 transition-colors">
                    <span className="text-gray-500 flex items-center gap-2"><Briefcase size={12}/> Experiência</span>
                    <span className="text-gray-700 dark:text-gray-300 font-semibold">Nível Sênior</span>
                 </div>
                 <div className="flex justify-between items-center p-2.5 bg-gray-50 dark:bg-gray-800/30 rounded border border-gray-200 dark:border-gray-800 hover:border-emerald-500/30 transition-colors">
                    <span className="text-gray-500 flex items-center gap-2"><Clock size={12}/> Tempo Online</span>
                    <span className="text-gray-700 dark:text-gray-300 font-semibold">99.9%</span>
                 </div>
              </div>
            </div>

            {/* Right Column: Bio & Content */}
            <div className="md:w-2/3">
               <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                 <Terminal size={20} className="text-emerald-600 dark:text-emerald-500" />
                 <span>Missão</span>
               </h3>
               <div className="relative pl-6 border-l-2 border-emerald-500/30 mb-10">
                 <p className="text-gray-600 dark:text-gray-400 leading-relaxed font-light text-lg">
                   Acredito que o desenvolvimento de software é uma forma de arte funcional. Meu objetivo com o 
                   <span className="font-mono text-emerald-600 dark:text-emerald-500 font-medium mx-1">CodeOmar</span> 
                   é desmistificar conceitos complexos de arquitetura, DevOps e engenharia de software, transformando 
                   teoria acadêmica em prática de produção.
                 </p>
               </div>

               <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2">
                 <Cpu size={20} className="text-emerald-600 dark:text-emerald-500" />
                 <span>Stack Tecnológica</span>
               </h3>
               
               <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-10">
                  <div className="p-4 rounded-lg bg-gray-50 dark:bg-gray-900/40 border border-gray-200 dark:border-gray-800 hover:border-emerald-500/30 transition-colors group">
                     <h4 className="font-mono text-xs text-gray-500 mb-3 uppercase tracking-wider group-hover:text-emerald-500 transition-colors">Frontend Core</h4>
                     <div className="flex flex-wrap gap-2">
                        {['React 19', 'Next.js', 'Tailwind', 'TypeScript', 'Framer Motion'].map(t => (
                            <span key={t} className="px-2.5 py-1 text-xs rounded bg-white dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-300 font-mono border border-gray-200 dark:border-emerald-500/20">{t}</span>
                        ))}
                     </div>
                  </div>
                  <div className="p-4 rounded-lg bg-gray-50 dark:bg-gray-900/40 border border-gray-200 dark:border-gray-800 hover:border-emerald-500/30 transition-colors group">
                     <h4 className="font-mono text-xs text-gray-500 mb-3 uppercase tracking-wider group-hover:text-emerald-500 transition-colors">Backend & Cloud</h4>
                     <div className="flex flex-wrap gap-2">
                        {['Python', 'Django', 'Node.js', 'Go', 'PostgreSQL', 'Redis', 'Docker', 'K8s'].map(t => (
                            <span key={t} className="px-2.5 py-1 text-xs rounded bg-white dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-300 font-mono border border-gray-200 dark:border-emerald-500/20">{t}</span>
                        ))}
                     </div>
                  </div>
               </div>
               
               <div className="pt-6 border-t border-gray-200 dark:border-gray-800 flex flex-wrap gap-6 text-sm text-gray-500 font-mono">
                  <a href="https://github.com/SaideLeon" target="_blank" rel="noopener noreferrer" className="flex items-center gap-2 hover:text-emerald-600 dark:hover:text-emerald-500 transition-colors">
                     <Globe size={16} />
                     github.com/SaideLeon
                  </a>
                  <a href="#" className="flex items-center gap-2 hover:text-emerald-600 dark:hover:text-emerald-500 transition-colors">
                     <Coffee size={16} />
                     Pague-me um café
                  </a>
                  <span className="flex items-center gap-2 ml-auto text-gray-400">
                     <Heart size={14} className="text-red-500/80" />
                     Feito com lógica
                  </span>
               </div>
            </div>
          </div>

        </div>
      </WindowFrame>
    </div>
  );
};

export default AboutView;

========================================
Arquivo: services/supabaseClient.ts
========================================

import { createClient } from '@supabase/supabase-js';

const SUPABASE_URL = 'https://lklydqknwbbbzwxnvguj.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_DZ33TBjx6gZfgM7UTTBb7A_UT-gwUX7';

export const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

========================================
Arquivo: components/AuthModal.tsx
========================================

import React, { useState } from 'react';
import { supabase } from '../services/supabaseClient';
import { X, Mail, Lock, User, Loader, AlertCircle } from 'lucide-react';
import WindowFrame from './WindowFrame';

interface AuthModalProps {
  isOpen: boolean;
  onClose: () => void;
}

const AuthModal: React.FC<AuthModalProps> = ({ isOpen, onClose }) => {
  const [isLogin, setIsLogin] = useState(true);
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [username, setUsername] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  if (!isOpen) return null;

  const handleAuth = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError(null);

    try {
      if (isLogin) {
        const { error } = await supabase.auth.signInWithPassword({
          email,
          password,
        });
        if (error) throw error;
        onClose();
      } else {
        const { error } = await supabase.auth.signUp({
          email,
          password,
          options: {
            data: {
              username,
              avatar_url: `https://api.dicebear.com/7.x/avataaars/svg?seed=${username}`,
            },
          },
        });
        if (error) throw error;
        // Auto close on success, or show "check email" message if email confirmation is on
        onClose();
      }
    } catch (err: any) {
      setError(err.message || 'Ocorreu um erro durante a autenticação');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200">
      <div className="w-full max-w-md relative" onClick={(e) => e.stopPropagation()}>
        <button 
          onClick={onClose}
          className="absolute -top-12 right-0 text-white/70 hover:text-white transition-colors"
        >
          <X size={24} />
        </button>
        
        <WindowFrame title={isLogin ? "auth_login.exe" : "registro_usuario.sh"} className="shadow-2xl">
          <div className="p-8 bg-white dark:bg-[#0b0e11]">
            <div className="text-center mb-8">
              <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                {isLogin ? 'Bem-vindo de volta' : 'Junte-se à Rede'}
              </h2>
              <p className="text-sm text-gray-500 dark:text-gray-400 font-mono">
                {isLogin ? 'Insira as credenciais para acesso root.' : 'Inicializar novo perfil de usuário.'}
              </p>
            </div>

            {error && (
              <div className="mb-6 p-3 bg-red-500/10 border border-red-500/20 rounded flex items-start gap-3">
                <AlertCircle className="text-red-500 shrink-0 mt-0.5" size={16} />
                <p className="text-xs text-red-600 dark:text-red-400 font-mono">{error}</p>
              </div>
            )}

            <form onSubmit={handleAuth} className="space-y-4">
              {!isLogin && (
                <div className="space-y-1">
                  <label className="text-xs font-mono text-gray-500 uppercase">Usuário</label>
                  <div className="relative">
                    <User className="absolute left-3 top-2.5 text-gray-400" size={16} />
                    <input
                      type="text"
                      placeholder="dev_master"
                      value={username}
                      onChange={(e) => setUsername(e.target.value)}
                      className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg py-2 pl-10 pr-4 text-sm font-mono focus:outline-none focus:border-emerald-500 transition-colors dark:text-white"
                      required={!isLogin}
                    />
                  </div>
                </div>
              )}

              <div className="space-y-1">
                <label className="text-xs font-mono text-gray-500 uppercase">Email</label>
                <div className="relative">
                  <Mail className="absolute left-3 top-2.5 text-gray-400" size={16} />
                  <input
                    type="email"
                    placeholder="voce@code.omar"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg py-2 pl-10 pr-4 text-sm font-mono focus:outline-none focus:border-emerald-500 transition-colors dark:text-white"
                    required
                  />
                </div>
              </div>

              <div className="space-y-1">
                <label className="text-xs font-mono text-gray-500 uppercase">Senha</label>
                <div className="relative">
                  <Lock className="absolute left-3 top-2.5 text-gray-400" size={16} />
                  <input
                    type="password"
                    placeholder="••••••••"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg py-2 pl-10 pr-4 text-sm font-mono focus:outline-none focus:border-emerald-500 transition-colors dark:text-white"
                    required
                  />
                </div>
              </div>

              <button
                type="submit"
                disabled={loading}
                className="w-full mt-6 bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2.5 rounded-lg flex items-center justify-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-emerald-900/20"
              >
                {loading ? <Loader className="animate-spin" size={16} /> : (isLogin ? 'Entrar' : 'Criar Conta')}
              </button>
            </form>

            <div className="mt-6 text-center">
              <button
                onClick={() => setIsLogin(!isLogin)}
                className="text-xs text-gray-500 hover:text-emerald-500 font-mono underline underline-offset-4 transition-colors"
              >
                {isLogin ? "Não tem conta? mkdir user" : "Já tem conta? sudo login"}
              </button>
            </div>
          </div>
        </WindowFrame>
      </div>
    </div>
  );
};

export default AuthModal;

========================================
Arquivo: components/CommentSection.tsx
========================================

import React, { useEffect, useState } from 'react';
import { supabase } from '../services/supabaseClient';
import { MessageSquare, CornerDownRight, Send, User as UserIcon, Loader, X } from 'lucide-react';
import { formatDistanceToNow } from 'date-fns';
import { ptBR } from 'date-fns/locale';

interface Comment {
  id: string;
  content: string;
  created_at: string;
  user_id: string;
  parent_id: string | null;
  profiles: {
    username: string;
    avatar_url: string;
  };
  replies?: Comment[];
}

interface CommentSectionProps {
  postId: string;
  user: any; // Supabase user object
  onAuthRequest: () => void;
}

const CommentItem: React.FC<{ 
  comment: Comment; 
  user: any; 
  onReply: (parentId: string, username: string) => void 
}> = ({ comment, user, onReply }) => {
  return (
    <div className="mb-6 group">
      <div className="flex gap-3">
        <div className="flex-shrink-0 mt-1">
          {comment.profiles?.avatar_url ? (
            <img 
              src={comment.profiles.avatar_url} 
              alt={comment.profiles.username} 
              className="w-8 h-8 rounded-full border border-gray-200 dark:border-gray-700"
            />
          ) : (
            <div className="w-8 h-8 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-600">
              <UserIcon size={14} />
            </div>
          )}
        </div>
        <div className="flex-grow">
          <div className="bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-800 rounded-lg p-3 relative hover:border-emerald-500/30 transition-colors">
             <div className="flex justify-between items-start mb-1">
                <span className="text-xs font-bold text-gray-900 dark:text-emerald-400 font-mono">
                  @{comment.profiles?.username || 'usuario_anonimo'}
                </span>
                <span className="text-[10px] text-gray-400 font-mono">
                  {formatDistanceToNow(new Date(comment.created_at), { addSuffix: true, locale: ptBR })}
                </span>
             </div>
             <p className="text-sm text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap">
               {comment.content}
             </p>
             {user && (
               <button 
                 onClick={() => onReply(comment.id, comment.profiles?.username)}
                 className="mt-2 text-[10px] font-bold text-gray-400 hover:text-emerald-500 flex items-center gap-1 transition-colors uppercase tracking-wider"
               >
                 <CornerDownRight size={10} /> Responder
               </button>
             )}
          </div>
        </div>
      </div>
      
      {/* Nested Replies */}
      {comment.replies && comment.replies.length > 0 && (
        <div className="ml-8 pl-4 border-l border-gray-200 dark:border-gray-800 mt-4 space-y-4">
          {comment.replies.map(reply => (
            <CommentItem key={reply.id} comment={reply} user={user} onReply={onReply} />
          ))}
        </div>
      )}
    </div>
  );
};

const CommentSection: React.FC<CommentSectionProps> = ({ postId, user, onAuthRequest }) => {
  const [comments, setComments] = useState<Comment[]>([]);
  const [loading, setLoading] = useState(true);
  const [newComment, setNewComment] = useState('');
  const [replyingTo, setReplyingTo] = useState<{ id: string; username: string } | null>(null);
  const [submitting, setSubmitting] = useState(false);

  // Validate UUID to prevent API errors
  const isValidUUID = (uuid: string) => {
    return /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(uuid);
  };

  const fetchComments = async () => {
    // Safety check for preview mode strings or invalid IDs
    if (!postId || !isValidUUID(postId)) {
        setLoading(false);
        return;
    }

    try {
      const { data, error } = await supabase
        .from('comments')
        .select(`
          *,
          profiles (username, avatar_url)
        `)
        .eq('post_id', postId)
        .order('created_at', { ascending: true });

      if (error) throw error;

      // Build tree
      const commentMap = new Map();
      const roots: Comment[] = [];

      data?.forEach((comment: any) => {
        comment.replies = [];
        commentMap.set(comment.id, comment);
      });

      data?.forEach((comment: any) => {
        if (comment.parent_id) {
          const parent = commentMap.get(comment.parent_id);
          if (parent) parent.replies.push(comment);
        } else {
          roots.push(comment);
        }
      });

      setComments(roots);
    } catch (error) {
      console.error('Erro ao buscar comentários:', error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchComments();
    
    // Only subscribe if valid UUID
    if (!isValidUUID(postId)) return;

    const channel = supabase
      .channel('public:comments')
      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'comments', filter: `post_id=eq.${postId}` }, () => {
        fetchComments();
      })
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [postId]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!newComment.trim() || !user || !isValidUUID(postId)) return;

    setSubmitting(true);
    try {
      const { error } = await supabase.from('comments').insert({
        content: newComment.trim(),
        post_id: postId,
        user_id: user.id,
        parent_id: replyingTo?.id || null,
      });

      if (error) throw error;

      setNewComment('');
      setReplyingTo(null);
      // Fetch handled by realtime subscription
    } catch (error) {
      console.error('Erro ao postar comentário:', error);
      alert('Falha ao postar comentário');
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <div className="mt-16 pt-10 border-t border-gray-200 dark:border-gray-800">
      <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-8 flex items-center gap-2">
        <MessageSquare size={20} className="text-emerald-500" />
        Discussão <span className="text-sm font-normal text-gray-500 font-mono">({comments.reduce((acc, c) => acc + 1 + (c.replies?.length || 0), 0)})</span>
      </h3>

      {/* Input Area */}
      <div className="mb-10">
        {!user ? (
          <div className="bg-gray-50 dark:bg-[#15191e] rounded-lg p-6 text-center border border-dashed border-gray-300 dark:border-gray-700">
            <p className="text-gray-600 dark:text-gray-400 mb-4 text-sm">Faça login para entrar na conversa e interagir com outros engenheiros.</p>
            <button 
              onClick={onAuthRequest}
              className="px-6 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded font-mono text-sm font-bold transition-colors shadow-lg shadow-emerald-900/20"
            >
              /bin/login
            </button>
          </div>
        ) : (
          <form onSubmit={handleSubmit} className="relative">
            {replyingTo && (
              <div className="flex items-center justify-between bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 px-3 py-2 rounded-t text-xs font-mono mb-px mx-1">
                <span>Respondendo a @{replyingTo.username}</span>
                <button type="button" onClick={() => setReplyingTo(null)} className="hover:text-red-500"><X size={12} /></button>
              </div>
            )}
            <div className="relative">
               <textarea
                 value={newComment}
                 onChange={(e) => setNewComment(e.target.value)}
                 className={`w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 p-4 text-sm focus:outline-none focus:border-emerald-500 transition-colors text-gray-900 dark:text-white font-mono resize-none ${replyingTo ? 'rounded-b-lg rounded-t-none' : 'rounded-lg'}`}
                 placeholder="echo 'Seu pensamento aqui...'"
                 rows={3}
               />
               <button 
                 type="submit"
                 disabled={!newComment.trim() || submitting}
                 className="absolute bottom-3 right-3 p-2 bg-emerald-600 hover:bg-emerald-500 disabled:bg-gray-300 dark:disabled:bg-gray-700 text-white rounded-md transition-colors shadow-sm"
               >
                 {submitting ? <Loader className="animate-spin" size={16} /> : <Send size={16} />}
               </button>
            </div>
          </form>
        )}
      </div>

      {/* Comments List */}
      {loading ? (
        <div className="space-y-4">
           {[1, 2].map(i => (
             <div key={i} className="flex gap-3 animate-pulse">
                <div className="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-800"></div>
                <div className="flex-1 space-y-2">
                   <div className="h-20 bg-gray-200 dark:bg-gray-800 rounded"></div>
                </div>
             </div>
           ))}
        </div>
      ) : comments.length === 0 ? (
        <div className="text-center py-8 text-gray-500 font-mono text-sm">
           Nenhum comentário ainda. Seja o primeiro a compilar seus pensamentos.
        </div>
      ) : (
        <div>
           {comments.map(comment => (
             <CommentItem key={comment.id} comment={comment} user={user} onReply={(parentId, username) => setReplyingTo({ id: parentId, username })} />
           ))}
        </div>
      )}
    </div>
  );
};

export default CommentSection;

========================================
Arquivo: README.md
========================================

# Runtime::Log ⚡️

> **Status do Sistema:** Online  
> **Tema:** Cyberpunk / Focado em Desenvolvedores  
> **Stack:** React + Supabase + Google Gemini AI + Node.js Server

**Runtime::Log** é uma plataforma de blog de alto desempenho projetada especificamente para engenheiros de software. Apresenta uma estética inspirada em terminais, renderização de conteúdo técnico aprofundado e recursos impulsionados por IA.

## 🚀 Recursos

### 🎨 UX/UI
- **Estética Neon/Modo Escuro:** Construído com Tailwind CSS.
- **Design Responsivo:** Totalmente otimizado para mobile, tablet e desktop.

### 📝 Conteúdo & IA
- **Suporte a Markdown:** Renderiza texto rico e blocos de código.
- **Integração Gemini AI:** Gera insights de pesquisa e rascunhos de artigos.

## 🛠 Instalação e Configuração

### 1. Instale as dependências
```bash
npm install
```

### 2. Configuração de Ambiente (.env)
Seguindo o padrão **Vite**, as variáveis de ambiente devem começar com `VITE_`.

1. Renomeie o arquivo de exemplo:
   ```bash
   cp .env.example .env
   ```
2. Abra o arquivo `.env` e adicione sua chave:
   ```env
   VITE_API_KEY=sua_chave_api_google_aqui
   ```

### 3. Execute a aplicação
```bash
npm start
```
Acesse em `http://localhost:3000`.

## 📂 Estrutura

- **Frontend:** React (via ES Modules/esm.sh) no `index.html` e `src/`.
- **Backend:** `server.js` (Express) serve o frontend e injeta a `VITE_API_KEY`.
- **Config:** `services/config.ts` unifica o acesso via `import.meta.env` e polyfill.

## 🔐 Licença

Licença MIT.

========================================
Arquivo: services/config.ts
========================================

import env from 'env-var';

// Helper robusto para pegar variáveis de ambiente
// Tenta: 1. import.meta.env (Padrão Vite)
// Tenta: 2. window.process.env (Nosso Polyfill / Node servers)
const getEnvValue = (key: string): string => {
  // 1. Tentar import.meta.env (Vite Standard)
  try {
    // @ts-ignore - import.meta pode não existir em todos os contextos de TS
    if (typeof import.meta !== 'undefined' && import.meta.env && import.meta.env[key]) {
      // @ts-ignore
      return import.meta.env[key];
    }
  } catch (e) {
    // Ignore access errors
  }

  // 2. Tentar window.process.env (Polyfill do server.js)
  try {
    // @ts-ignore
    if (typeof window !== 'undefined' && window.process && window.process.env && window.process.env[key]) {
       // @ts-ignore
       return window.process.env[key];
    }
  } catch (e) {
    // Ignore
  }

  return '';
};

export const config = {
  // Busca VITE_API_KEY usando a lógica híbrida
  API_KEY: getEnvValue('VITE_API_KEY'),
};

export const hasApiKey = (): boolean => {
  return config.API_KEY.length > 0;
};

========================================
Arquivo: server.js
========================================

const dotenv = require('dotenv');
const express = require('express');
const path = require('path');
const fs = require('fs');

// Tenta carregar o .env e loga o resultado
const envConfig = dotenv.config();
if (envConfig.error) {
  console.log('ℹ️  Arquivo .env não encontrado, usando variáveis de ambiente do sistema.');
} else {
  console.log('📄 Arquivo .env carregado com sucesso.');
}

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware de segurança para não expor o arquivo .env publicamente
app.use((req, res, next) => {
  if (req.path.includes('.env')) {
    return res.status(403).send('Forbidden');
  }
  next();
});

// Servir arquivos estáticos da raiz, exceto index.html (que será manipulado manualmente)
app.use(express.static(__dirname, { index: false }));

// Rota catch-all para servir o index.html e injetar a variável de ambiente
app.get('*', (req, res) => {
  const filePath = path.resolve(__dirname, 'index.html');
  
  fs.readFile(filePath, 'utf8', (err, data) => {
    if (err) {
      console.error(err);
      return res.status(500).send('Erro ao carregar index.html');
    }

    // Obtém a chave do arquivo .env ou das variáveis do sistema
    // Prioriza VITE_API_KEY (Padrão Vite), fallback para API_KEY antiga
    const apiKey = process.env.VITE_API_KEY || process.env.API_KEY || '';
    
    // Procura pelo placeholder no index.html e substitui pelo valor real
    // Regex ajustada para o novo nome da variável no index.html
    const result = data.replace(
      /VITE_API_KEY:\s*['"](.*?)['"]/, 
      `VITE_API_KEY: '${apiKey}'`
    );

    res.setHeader('Content-Type', 'text/html');
    res.send(result);
  });
});

app.listen(PORT, () => {
  console.log(`\n🚀 CodeOmar rodando em http://localhost:${PORT}`);
  if (process.env.VITE_API_KEY || process.env.API_KEY) {
    console.log(`✅ VITE_API_KEY detectada.`);
  } else {
    console.warn(`⚠️  AVISO CRÍTICO: VITE_API_KEY não encontrada.`);
    console.warn(`   Certifique-se de definir VITE_API_KEY no arquivo .env`);
  }
});

========================================
Arquivo: package.json
========================================

{
  "name": "codeomar",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "dotenv": "^16.4.5",
    "express": "^4.19.2"
  }
}

========================================
Arquivo: index.html
========================================

<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CodeOmar - Dev Blog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              // Custom colors can be added here if needed
            }
          }
        }
      }
    </script>
    <script>
      // Runtime Environment Injection
      // Este objeto simula o ambiente para compatibilidade
      window.process = {
        env: {
          // O servidor (server.js) irá substituir este valor vazio pela chave real do .env
          VITE_API_KEY: '' 
        }
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      body {
        /* Default to dark mode colors if JS fails, but classes will handle it */
        background-color: #050505; 
        color: #e5e5e5;
        font-family: 'Inter', sans-serif;
      }
      .font-mono {
        font-family: 'JetBrains Mono', monospace;
      }
      
      /* Scrollbar Styling */
      ::-webkit-scrollbar {
        width: 8px;
      }
      
      /* Light Mode Scrollbar */
      ::-webkit-scrollbar-track {
        background: #f3f4f6;
      }
      ::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #10b981;
      }

      /* Dark Mode Scrollbar */
      .dark ::-webkit-scrollbar-track {
        background: #0b0e11;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #333;
      }
      
      /* Reset body background when class is present to avoid conflicts */
      body {
        background-color: transparent;
        color: inherit;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "lucide-react": "https://esm.sh/lucide-react@^0.563.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "@google/genai": "https://esm.sh/@google/genai@^1.39.0",
    "react/": "https://esm.sh/react@^19.2.4/",
    "react": "https://esm.sh/react@^19.2.4",
    "framer-motion": "https://esm.sh/framer-motion@^12.29.3",
    "react-syntax-highlighter": "https://esm.sh/react-syntax-highlighter@15.5.0?external=react",
    "react-syntax-highlighter/dist/esm/styles/prism": "https://esm.sh/react-syntax-highlighter@15.5.0/dist/esm/styles/prism?external=react",
    "react-syntax-highlighter/": "https://esm.sh/react-syntax-highlighter@^16.1.0/",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2.39.3",
    "date-fns": "https://esm.sh/date-fns@2.30.0",
    "date-fns/": "https://esm.sh/date-fns@^4.1.0/",
    "env-var": "https://esm.sh/env-var@^7.5.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body class="bg-gray-50 text-gray-900 dark:bg-[#050505] dark:text-[#e5e5e5] transition-colors duration-300">
    <div id="root"></div>
  <script type="module" src="/index.tsx"></script>
</body>
</html>

========================================
Arquivo: index.tsx
========================================

import React from 'react';
import { createRoot } from 'react-dom/client';
import App from './App';

const container = document.getElementById('root');
if (container) {
  const root = createRoot(container);
  root.render(<App />);
}


========================================
Arquivo: tsconfig.json
========================================

{
  "compilerOptions": {
    "target": "ES2022",
    "experimentalDecorators": true,
    "useDefineForClassFields": false,
    "module": "ESNext",
    "lib": [
      "ES2022",
      "DOM",
      "DOM.Iterable"
    ],
    "skipLibCheck": true,
    "types": [
      "node"
    ],
    "moduleResolution": "bundler",
    "isolatedModules": true,
    "moduleDetection": "force",
    "allowJs": true,
    "jsx": "react-jsx",
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "allowImportingTsExtensions": true,
    "noEmit": true
  }
}

========================================
Arquivo: vite.config.ts
========================================

import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig(({ mode }) => {
    const env = loadEnv(mode, '.', '');
    return {
      server: {
        port: 3000,
        host: '0.0.0.0',
      },
      plugins: [react()],
      define: {
        'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),
        'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)
      },
      resolve: {
        alias: {
          '@': path.resolve(__dirname, '.'),
        }
      }
    };
});


========================================
Arquivo: components/ArticleView.tsx
========================================

import React, { useEffect, useState } from 'react';
import { BlogPost } from '../types';
import WindowFrame from './WindowFrame';
import { ArrowLeft, ArrowRight, Clock, Calendar, Hash, Sparkles, Copy, Check, Link as LinkIcon, Quote, Type, Minus, Plus, Heart, Eye } from 'lucide-react';
import { generateArticleContent } from '../services/geminiService';
import { supabase } from '../services/supabaseClient';
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';
import { vscDarkPlus } from 'react-syntax-highlighter/dist/esm/styles/prism';
import CommentSection from './CommentSection';

interface ArticleViewProps {
  post: BlogPost;
  user: any;
  onAuthRequest: () => void;
  onBack: () => void;
  previousPost?: BlogPost | null;
  nextPost?: BlogPost | null;
  onNavigate?: (post: BlogPost) => void;
  previewMode?: boolean;
}

const CodeBlock: React.FC<{ code: string; language?: string }> = ({ code, language = 'text' }) => {
  const [copied, setCopied] = useState(false);

  const handleCopy = async () => {
    try {
      await navigator.clipboard.writeText(code);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    } catch (err) {
      console.error('Failed to copy text: ', err);
    }
  };

  // We keep code blocks dark even in light mode for better readability of code
  return (
    <div className="my-8 border border-gray-200 dark:border-emerald-500/20 rounded-lg overflow-hidden bg-[#1e1e1e] shadow-lg shadow-black/20 dark:shadow-black/50">
      <div className="flex items-center justify-between px-4 py-2 bg-[#0b0e11] border-b border-white/10 dark:border-emerald-500/10">
        <div className="flex gap-2 items-center">
           <div className="flex gap-1.5">
             <div className="w-2.5 h-2.5 rounded-full bg-emerald-500/20"></div>
             <div className="w-2.5 h-2.5 rounded-full bg-emerald-500/20"></div>
             <div className="w-2.5 h-2.5 rounded-full bg-emerald-500/20"></div>
           </div>
           <span className="text-xs font-mono text-gray-500 uppercase ml-2 select-none">{language}</span>
        </div>
        <button 
          onClick={handleCopy}
          className="flex items-center gap-1.5 text-xs font-mono text-gray-500 hover:text-emerald-400 transition-colors"
          title="Copiar para área de transferência"
        >
          {copied ? <Check size={14} className="text-emerald-500" /> : <Copy size={14} />}
          {copied ? 'Copiado' : 'Copiar'}
        </button>
      </div>
      <div className="overflow-x-auto custom-scrollbar">
        <SyntaxHighlighter
          language={language.toLowerCase()}
          style={vscDarkPlus}
          customStyle={{
            margin: 0,
            padding: '1.5rem',
            background: 'transparent',
            fontSize: '0.875rem',
            lineHeight: '1.6',
            fontFamily: "'JetBrains Mono', monospace",
          }}
          wrapLongLines={true}
        >
          {code}
        </SyntaxHighlighter>
      </div>
    </div>
  );
};

// Helper for parsing inline markdown styles
const parseInline = (text: string): React.ReactNode[] => {
  const parts = text.split(/(`[^`]+`|\*\*[^*]+\*\*|\*[^*]+\*|\[[^\]]+\]\([^)]+\))/g);
  
  return parts.map((part, index) => {
    // Inline Code
    if (part.startsWith('`') && part.endsWith('`')) {
      return (
        <code key={index} className="bg-gray-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300 px-1.5 py-0.5 rounded text-sm font-mono border border-gray-200 dark:border-emerald-500/20 mx-0.5">
          {part.slice(1, -1)}
        </code>
      );
    }
    // Bold
    if (part.startsWith('**') && part.endsWith('**')) {
      return <strong key={index} className="text-gray-900 dark:text-emerald-100 font-bold">{part.slice(2, -2)}</strong>;
    }
    // Italic
    if (part.startsWith('*') && part.endsWith('*')) {
      return <em key={index} className="text-gray-600 dark:text-gray-300 italic">{part.slice(1, -1)}</em>;
    }
    // Link
    if (part.startsWith('[') && part.includes('](') && part.endsWith(')')) {
      const match = part.match(/\[(.*?)\]\((.*?)\)/);
      if (match) {
        return (
          <a 
            key={index} 
            href={match[2]} 
            className="text-emerald-600 dark:text-emerald-400 hover:text-emerald-500 dark:hover:text-emerald-300 underline underline-offset-4 decoration-emerald-500/30 hover:decoration-emerald-500 transition-all" 
            target="_blank" 
            rel="noopener noreferrer"
          >
            {match[1]}
          </a>
        );
      }
    }
    return part;
  });
};

const ArticleView: React.FC<ArticleViewProps> = ({ post, user, onAuthRequest, onBack, previousPost, nextPost, onNavigate, previewMode = false }) => {
  const [content, setContent] = useState<string>(post.content || '');
  const [isLoading, setIsLoading] = useState(!post.content);
  
  // Likes State
  const [likesCount, setLikesCount] = useState(0);
  const [hasLiked, setHasLiked] = useState(false);

  // Font Size State
  const [fontSize, setFontSize] = useState<number>(() => {
    if (typeof window !== 'undefined') {
      const saved = localStorage.getItem('articleFontSize');
      return saved ? parseInt(saved, 10) : 1; // Default index 1 is text-lg
    }
    return 1;
  });

  useEffect(() => {
    localStorage.setItem('articleFontSize', fontSize.toString());
  }, [fontSize]);

  // Fetch Likes
  useEffect(() => {
    if (previewMode) return; // Skip fetching likes in preview mode

    const fetchLikes = async () => {
      const { count } = await supabase
        .from('post_likes')
        .select('*', { count: 'exact' })
        .eq('post_id', post.id);
      
      setLikesCount(count || 0);

      if (user) {
        const { data } = await supabase
          .from('post_likes')
          .select('*')
          .eq('post_id', post.id)
          .eq('user_id', user.id)
          .single();
        
        setHasLiked(!!data);
      } else {
        setHasLiked(false);
      }
    };

    fetchLikes();
  }, [post.id, user, previewMode]);

  const handleLike = async () => {
    if (previewMode) return;

    if (!user) {
      onAuthRequest();
      return;
    }

    if (hasLiked) {
      await supabase.from('post_likes').delete().eq('post_id', post.id).eq('user_id', user.id);
      setHasLiked(false);
      setLikesCount(prev => prev - 1);
    } else {
      await supabase.from('post_likes').insert({ post_id: post.id, user_id: user.id });
      setHasLiked(true);
      setLikesCount(prev => prev + 1);
    }
  };

  const fontSizes = ['text-base', 'text-lg', 'text-xl', 'text-2xl'];
  const lineHeights = ['leading-7', 'leading-8', 'leading-9', 'leading-10'];
  const currentFontSizeClass = fontSizes[fontSize];
  const currentLineHeightClass = lineHeights[fontSize];

  useEffect(() => {
    if (!content) {
      const fetchContent = async () => {
        setIsLoading(true);
        const generated = await generateArticleContent(post.title, post.excerpt);
        setContent(generated);
        setIsLoading(false);
      };
      fetchContent();
    }
  }, [post, content]);

  const generateId = (text: string) => {
    return text.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '');
  };

  const scrollToHeading = (id: string) => {
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  };

  const renderContent = (text: string) => {
    const lines = text.split('\n');
    const elements: React.ReactNode[] = [];
    let codeBuffer: string[] = [];
    let language = 'text';
    let inCodeBlock = false;
    let paragraphBuffer: string[] = [];
    
    const flushParagraph = () => {
        if (paragraphBuffer.length > 0) {
            const combinedText = paragraphBuffer.join(' ').trim();
            if (combinedText) {
                elements.push(
                    <p key={`p-${elements.length}`} className={`mb-6 text-gray-700 dark:text-gray-300 ${currentLineHeightClass} ${currentFontSizeClass} tracking-normal`}>
                        {parseInline(combinedText)}
                    </p>
                );
            }
            paragraphBuffer = [];
        }
    };

    lines.forEach((line, idx) => {
        const trimmed = line.trim();
        
        // CODE BLOCKS
        if (trimmed.startsWith('```')) {
            if (inCodeBlock) {
                elements.push(<CodeBlock key={`code-${idx}`} code={codeBuffer.join('\n')} language={language} />);
                codeBuffer = [];
                inCodeBlock = false;
            } else {
                flushParagraph();
                inCodeBlock = true;
                const match = trimmed.match(/```(\w+)?/);
                language = match && match[1] ? match[1] : 'text';
            }
            return;
        }

        if (inCodeBlock) {
            codeBuffer.push(line);
            return;
        }

        // H1
        if (line.startsWith('# ')) {
            flushParagraph();
            elements.push(
                <h1 key={`h1-${idx}`} className="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-600 dark:from-emerald-400 dark:to-teal-400 mt-16 mb-8 border-b border-gray-200 dark:border-emerald-500/20 pb-4">
                    {line.replace('# ', '')}
                </h1>
            );
            return;
        }
        
        // H2
        if (line.startsWith('## ')) {
            flushParagraph();
            const text = line.replace('## ', '');
            const id = generateId(text);
            elements.push(
               <div key={`h2-${idx}`} className="group flex items-center gap-3 mt-12 mb-6">
                 <div className="w-1 h-8 bg-emerald-500 rounded-full opacity-70"></div>
                 <h2 id={id} className="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white group-hover:text-emerald-500 transition-colors">
                    {text}
                 </h2>
               </div>
            );
            return;
        }

        // H3
        if (line.startsWith('### ')) {
            flushParagraph();
            elements.push(
                <h3 key={`h3-${idx}`} className="text-xl md:text-2xl font-bold text-gray-800 dark:text-gray-100 mt-10 mb-4 flex items-center gap-2">
                   <span className="text-emerald-500/50">###</span> {line.replace('### ', '')}
                </h3>
            );
            return;
        }

        // Blockquotes
        if (line.startsWith('> ')) {
             flushParagraph();
             elements.push(
                <blockquote key={`quote-${idx}`} className="my-8 p-6 bg-emerald-50 dark:bg-emerald-900/10 border-l-4 border-emerald-500 rounded-r-lg italic text-gray-700 dark:text-gray-300 relative">
                   <Quote className="absolute top-4 right-4 text-emerald-500/20" size={24} />
                   {parseInline(line.replace('> ', ''))}
                </blockquote>
             );
             return;
        }
        
        // List items (basic support)
        if (line.trim().startsWith('- ') || line.trim().startsWith('* ')) {
            flushParagraph();
            const content = line.trim().substring(2);
            elements.push(
                <li key={`li-${idx}`} className={`ml-6 mb-2 list-disc marker:text-emerald-500 text-gray-700 dark:text-gray-300 ${currentFontSizeClass} pl-2`}>
                   {parseInline(content)}
                </li>
            );
            return;
        }

        // Empty lines trigger flush
        if (trimmed === '') {
            flushParagraph();
            return;
        }

        // Accumulate text
        paragraphBuffer.push(line);
    });

    flushParagraph(); // Final flush
    return elements;
  };

  return (
    <div className="min-h-screen bg-white dark:bg-[#050505] transition-colors duration-300">
       {/* Progress Bar */}
       <div className="fixed top-0 left-0 w-full h-1 z-50 bg-gray-200 dark:bg-gray-800">
          <div className="h-full bg-emerald-500" style={{ width: '0%', transition: 'width 0.1s' }} id="reading-progress"></div>
       </div>

       {/* Floating Navigation (Desktop) */}
       <div className="fixed top-24 right-8 z-40 hidden xl:flex flex-col gap-4">
          <div className="bg-white/90 dark:bg-[#0b0e11]/90 backdrop-blur border border-gray-200 dark:border-gray-800 rounded-lg p-2 shadow-xl space-y-2">
             <button onClick={() => setFontSize(Math.min(fontSize + 1, 3))} className="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded text-gray-600 dark:text-gray-400" title="Aumentar Fonte"><Plus size={16}/></button>
             <button onClick={() => setFontSize(Math.max(fontSize - 1, 0))} className="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded text-gray-600 dark:text-gray-400" title="Diminuir Fonte"><Minus size={16}/></button>
          </div>
          <div className="bg-white/90 dark:bg-[#0b0e11]/90 backdrop-blur border border-gray-200 dark:border-gray-800 rounded-lg p-2 shadow-xl">
             <button onClick={handleLike} className={`p-2 rounded transition-colors ${hasLiked ? 'text-red-500 bg-red-50 dark:bg-red-900/20' : 'text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/10'}`}>
                <Heart size={20} fill={hasLiked ? "currentColor" : "none"} />
                <span className="text-xs font-mono block text-center mt-1">{likesCount}</span>
             </button>
          </div>
       </div>

       <div className="max-w-3xl mx-auto px-4 py-12 md:py-20">
          {/* Back Button */}
          <button 
            onClick={onBack}
            className="group mb-8 flex items-center gap-2 text-sm font-mono text-gray-500 hover:text-emerald-600 dark:hover:text-emerald-500 transition-colors"
          >
            <ArrowLeft size={16} className="group-hover:-translate-x-1 transition-transform" />
            cd ..
          </button>

          <WindowFrame className="shadow-2xl dark:shadow-[0_0_100px_rgba(16,185,129,0.1)] mb-12">
            <div className="bg-white dark:bg-[#0b0e11] min-h-[800px] p-8 md:p-12 relative overflow-hidden">
               {/* Background Watermark */}
               <div className="absolute top-0 right-0 p-8 opacity-5 pointer-events-none">
                  <Hash size={200} className="text-emerald-500" />
               </div>

               {/* Header */}
               <header className="relative z-10 mb-12 border-b border-gray-100 dark:border-gray-800 pb-12">
                  <div className="flex flex-wrap gap-3 mb-6">
                    <span className="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-mono bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 border border-emerald-200 dark:border-emerald-500/20">
                      <Hash size={12} /> {post.category}
                    </span>
                    {/* NEW: Subcategory Badge */}
                    {post.subcategory && (
                        <span className="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-mono bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 border border-gray-200 dark:border-gray-700">
                          {post.subcategory}
                        </span>
                    )}

                    {post.tags?.map(tag => (
                      <span key={tag} className="inline-flex items-center px-2 py-1 rounded text-[10px] font-mono bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400">
                        {tag}
                      </span>
                    ))}
                  </div>

                  <h1 className="text-4xl md:text-5xl lg:text-6xl font-extrabold tracking-tight text-gray-900 dark:text-white mb-8 leading-tight">
                    {post.title}
                  </h1>

                  <div className="flex flex-wrap items-center gap-6 text-sm text-gray-500 font-mono">
                     <div className="flex items-center gap-2">
                        <Calendar size={14} />
                        {post.date}
                     </div>
                     <div className="flex items-center gap-2">
                        <Clock size={14} />
                        {post.readTime}
                     </div>
                     <div className="flex items-center gap-2 text-emerald-600 dark:text-emerald-500">
                        <Type size={14} />
                        Markdown
                     </div>
                  </div>
               </header>

               {/* Main Content */}
               <article className="relative z-10 font-sans">
                  {isLoading ? (
                    <div className="space-y-8 animate-pulse">
                       <div className="h-4 bg-gray-200 dark:bg-gray-800 rounded w-full"></div>
                       <div className="h-4 bg-gray-200 dark:bg-gray-800 rounded w-5/6"></div>
                       <div className="h-4 bg-gray-200 dark:bg-gray-800 rounded w-4/6"></div>
                       <div className="h-32 bg-gray-200 dark:bg-gray-800 rounded-lg mt-8"></div>
                       <div className="h-4 bg-gray-200 dark:bg-gray-800 rounded w-full mt-8"></div>
                       <div className="flex justify-center mt-12">
                          <div className="flex items-center gap-3 text-emerald-600 dark:text-emerald-500 font-mono text-sm">
                             <Sparkles className="animate-spin" />
                             Gerando conteúdo via Gemini AI...
                          </div>
                       </div>
                    </div>
                  ) : (
                    renderContent(content)
                  )}
               </article>

               {/* Footer / Author */}
               <div className="mt-16 pt-10 border-t border-gray-200 dark:border-gray-800">
                  <div className="flex items-center justify-between">
                     <div className="flex items-center gap-4">
                        <div className="w-12 h-12 rounded-full bg-gradient-to-tr from-emerald-500 to-cyan-500 p-[2px]">
                           <div className="w-full h-full rounded-full bg-white dark:bg-[#0b0e11] flex items-center justify-center">
                              <span className="font-bold text-emerald-600 dark:text-emerald-500">RL</span>
                           </div>
                        </div>
                        <div>
                           <p className="text-sm font-bold text-gray-900 dark:text-white">Time CodeOmar</p>
                           <p className="text-xs text-gray-500 font-mono">Conteúdo Gerado pelo Sistema</p>
                        </div>
                     </div>
                     
                     <div className="flex gap-2">
                        <button 
                           onClick={handleLike}
                           className={`p-2 rounded-full transition-colors flex items-center gap-2 border ${hasLiked ? 'border-red-500 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400' : 'border-gray-200 dark:border-gray-800 text-gray-500 hover:border-red-500 hover:text-red-500'}`}
                        >
                           <Heart size={18} fill={hasLiked ? "currentColor" : "none"} />
                           <span className="text-xs font-mono font-bold">{likesCount}</span>
                        </button>
                     </div>
                  </div>
               </div>

               {/* Comments - Hidden in Preview Mode */}
               {!previewMode && (
                  <CommentSection postId={post.id} user={user} onAuthRequest={onAuthRequest} />
               )}

            </div>
          </WindowFrame>
          
          {/* Next/Prev Navigation */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
             {previousPost ? (
                <button 
                  onClick={() => onNavigate && onNavigate(previousPost)}
                  className="group p-6 text-left bg-white dark:bg-[#0b0e11] border border-gray-200 dark:border-gray-800 rounded-lg hover:border-emerald-500/50 transition-all"
                >
                   <span className="text-xs font-mono text-gray-400 group-hover:text-emerald-500 flex items-center gap-1 mb-2">
                     <ArrowLeft size={12} /> Anterior
                   </span>
                   <h4 className="font-bold text-gray-900 dark:text-white group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors line-clamp-1">
                     {previousPost.title}
                   </h4>
                </button>
             ) : <div></div>}
             
             {nextPost && (
                <button 
                  onClick={() => onNavigate && onNavigate(nextPost)}
                  className="group p-6 text-right bg-white dark:bg-[#0b0e11] border border-gray-200 dark:border-gray-800 rounded-lg hover:border-emerald-500/50 transition-all"
                >
                   <span className="text-xs font-mono text-gray-400 group-hover:text-emerald-500 flex items-center gap-1 mb-2 justify-end">
                     Próximo <ArrowRight size={12} />
                   </span>
                   <h4 className="font-bold text-gray-900 dark:text-white group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors line-clamp-1">
                     {nextPost.title}
                   </h4>
                </button>
             )}
          </div>
       </div>
    </div>
  );
};

export default ArticleView;

========================================
Arquivo: App.tsx
========================================

import React, { useState, useEffect, useMemo } from 'react';
import { ViewState, BlogPost, UserProfile } from './types';
import GridBackground from './components/GridBackground';
import Hero from './components/Hero';
import WindowFrame from './components/WindowFrame';
import ArticleView from './components/ArticleView';
import SubscribeView from './components/SubscribeView';
import AboutView from './components/AboutView';
import AdminView from './components/AdminView';
import AuthModal from './components/AuthModal'; 
import { supabase } from './services/supabaseClient'; 
import { Search, Cpu, ChevronRight, Sparkles, Sun, Moon, LogIn, LogOut, ShieldAlert, EyeOff, Layers, Filter, Menu, X, Terminal, User } from 'lucide-react';
import { generateSearchInsights } from './services/geminiService';

const App: React.FC = () => {
  const [viewState, setViewState] = useState<ViewState>('HOME');
  const [selectedPost, setSelectedPost] = useState<BlogPost | null>(null);
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  
  // Filter States
  const [activeCategory, setActiveCategory] = useState<string>('all');
  const [activeSubcategory, setActiveSubcategory] = useState<string>('all');
  
  const [searchQuery, setSearchQuery] = useState('');
  const [searchInsight, setSearchInsight] = useState('');
  
  // Data State
  const [posts, setPosts] = useState<BlogPost[]>([]);
  const [loadingPosts, setLoadingPosts] = useState(true);

  // Auth State
  const [user, setUser] = useState<any>(null);
  const [userProfile, setUserProfile] = useState<UserProfile | null>(null);
  const [showAuthModal, setShowAuthModal] = useState(false);

  // Theme State
  const [theme, setTheme] = useState<'dark' | 'light'>(() => {
    if (typeof window !== 'undefined') {
      const saved = localStorage.getItem('theme');
      if (saved) return saved as 'dark' | 'light';
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    return 'dark';
  });

  // Helper to check for abort errors
  const isAbortError = (err: any) => {
    return (
      err?.name === 'AbortError' || 
      (err?.message && (
         err.message.includes('signal is aborted') || 
         err.message.includes('AbortError')
      ))
    );
  };

  // Fetch Posts from Supabase
  const fetchPosts = async () => {
    // Only set loading on initial fetch if posts are empty to avoid flicker on realtime updates
    if (posts.length === 0) setLoadingPosts(true);
    
    try {
      let query = supabase
        .from('posts')
        .select('*')
        .order('created_at', { ascending: false });

      // Logic: If user is NOT admin, only show 'published'.
      // If user IS admin, show everything.
      
      const { data: { session } } = await supabase.auth.getSession();
      
      // Determine if we should filter
      let isAdmin = false;
      if (session?.user) {
         // Optimistic check or fetch profile
         try {
             const { data: profile } = await supabase.from('profiles').select('role').eq('id', session.user.id).single();
             if (profile?.role === 'admin') isAdmin = true;
         } catch (profileErr) {
             // Ignore profile fetch errors here, assume not admin
         }
      }

      if (!isAdmin) {
         query = query.eq('status', 'published');
      }
      
      const { data, error } = await query;
      
      if (error) throw error;
      
      if (data) {
        const formattedPosts: BlogPost[] = data.map((p: any) => ({
          id: p.id,
          title: p.title,
          excerpt: p.excerpt,
          category: p.category,
          subcategory: p.subcategory, // Map subcategory
          readTime: p.read_time,
          date: new Date(p.created_at).toLocaleDateString('pt-BR'),
          content: p.content,
          tags: p.tags,
          slug: p.slug,
          status: p.status
        }));
        setPosts(formattedPosts);
      }
    } catch (err: any) {
      if (isAbortError(err)) {
          return;
      }
      console.error('Error loading posts:', err);
    } finally {
      setLoadingPosts(false);
    }
  };

  useEffect(() => {
    // Check active session
    supabase.auth.getSession().then(({ data: { session } }) => {
      setUser(session?.user ?? null);
      if (session?.user) fetchUserProfile(session.user.id);
    }).catch(err => {
        if (!isAbortError(err)) console.error("Session check error:", err);
    });

    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
      setUser(session?.user ?? null);
      if (session?.user) {
        fetchUserProfile(session.user.id);
      } else {
        setUserProfile(null);
      }
    });

    // Realtime subscription for Posts
    const postsChannel = supabase
      .channel('public:posts')
      .on('postgres_changes', { event: '*', schema: 'public', table: 'posts' }, () => {
        fetchPosts(); // Refresh on any change
      })
      .subscribe();

    return () => {
      subscription.unsubscribe();
      supabase.removeChannel(postsChannel);
    };
  }, []);

  // When userProfile changes (e.g. login as admin), re-fetch posts to potentially reveal drafts
  useEffect(() => {
     fetchPosts();
  }, [userProfile]);

  // Reset subcategory when category changes
  useEffect(() => {
    setActiveSubcategory('all');
  }, [activeCategory]);

  const fetchUserProfile = async (userId: string) => {
    try {
        const { data, error } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', userId)
        .single();
        
        if (error) throw error;

        if (data) {
            setUserProfile(data as UserProfile);
        }
    } catch (err: any) {
        if (!isAbortError(err)) {
            // Only log real errors
            console.error("Error fetching user profile:", err);
        }
    }
  };

  useEffect(() => {
    const root = window.document.documentElement;
    if (theme === 'dark') {
      root.classList.add('dark');
    } else {
      root.classList.remove('dark');
    }
    localStorage.setItem('theme', theme);
  }, [theme]);

  const toggleTheme = () => {
    setTheme(prev => prev === 'dark' ? 'light' : 'dark');
  };

  const handlePostClick = (post: BlogPost) => {
    setSelectedPost(post);
    setViewState('ARTICLE');
    window.scrollTo(0,0);
  };

  const handleBack = () => {
    setViewState('HOME');
    setSelectedPost(null);
  };

  const handleSearch = async (e: React.FormEvent) => {
    e.preventDefault();
    if (searchQuery.length > 2) {
        const insight = await generateSearchInsights(searchQuery);
        setSearchInsight(insight);
    }
  };

  const handleLogout = async () => {
    await supabase.auth.signOut();
    setViewState('HOME');
    setMobileMenuOpen(false);
  };

  const handleNavigation = (view: ViewState) => {
    setViewState(view);
    setMobileMenuOpen(false);
  };

  // --- Filtering Logic ---

  // 0. Compute Available Categories from database posts
  const availableCategories = useMemo(() => {
    const cats = Array.from(new Set(
      posts.map(p => p.category).filter(c => !!c && c.trim() !== '')
    ));
    return cats.sort();
  }, [posts]);

  // 1. Compute Available Subcategories based on active Category
  const availableSubcategories = useMemo(() => {
    const filteredByCat = activeCategory === 'all' 
      ? posts 
      : posts.filter(p => p.category === activeCategory);
      
    // Extract unique, non-empty subcategories
    const subs = Array.from(new Set(
      filteredByCat
        .map(p => p.subcategory)
        .filter((sub): sub is string => !!sub && sub.trim() !== '')
    ));
    
    return subs.sort();
  }, [posts, activeCategory]);

  // 2. Filter posts
  const filteredPosts = posts.filter(post => {
    const matchesCategory = activeCategory === 'all' || post.category === activeCategory;
    const matchesSubcategory = activeSubcategory === 'all' || post.subcategory === activeSubcategory;
    const matchesSearch = post.title.toLowerCase().includes(searchQuery.toLowerCase()) || 
                          post.excerpt.toLowerCase().includes(searchQuery.toLowerCase());
    
    return matchesCategory && matchesSubcategory && matchesSearch;
  });

  const currentPostIndex = selectedPost ? posts.findIndex(p => p.id === selectedPost.id) : -1;
  const previousPost = currentPostIndex > 0 ? posts[currentPostIndex - 1] : null;
  const nextPost = currentPostIndex !== -1 && currentPostIndex < posts.length - 1 ? posts[currentPostIndex + 1] : null;

  return (
    <div className="min-h-screen relative selection:bg-emerald-500/30 selection:text-emerald-900 dark:selection:text-emerald-200">
      <GridBackground />
      
      <AuthModal isOpen={showAuthModal} onClose={() => setShowAuthModal(false)} />

      {/* Navbar */}
      <nav className="fixed top-0 left-0 right-0 h-16 bg-white/80 dark:bg-[#050505]/80 backdrop-blur-lg border-b border-gray-200 dark:border-white/5 z-50 flex items-center px-6 justify-between transition-colors duration-300">
        <div 
          className="flex items-center gap-2 font-mono font-bold text-xl tracking-tighter cursor-pointer text-gray-900 dark:text-gray-200"
          onClick={handleBack}
        >
          <div className="w-8 h-8 bg-emerald-500 rounded flex items-center justify-center text-black shadow-sm">
            <Cpu size={20} />
          </div>
          <span>Code<span className="text-emerald-600 dark:text-emerald-500">Omar</span></span>
        </div>

        {/* Desktop Menu */}
        <div className="hidden md:flex items-center gap-6 text-sm font-mono text-gray-600 dark:text-gray-400">
          <button onClick={() => handleNavigation('HOME')} className={`hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors ${viewState === 'HOME' ? 'text-emerald-600 dark:text-emerald-400 font-medium' : ''}`}>/posts</button>
          <button onClick={() => handleNavigation('SUBSCRIBE')} className={`hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors ${viewState === 'SUBSCRIBE' ? 'text-emerald-600 dark:text-emerald-400 font-medium' : ''}`}>/assinar</button>
          <button onClick={() => handleNavigation('ABOUT')} className={`hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors ${viewState === 'ABOUT' ? 'text-emerald-600 dark:text-emerald-400 font-medium' : ''}`}>/sobre</button>
          
          {userProfile?.role === 'admin' && (
             <button onClick={() => handleNavigation('ADMIN')} className={`flex items-center gap-1 hover:text-red-500 transition-colors ${viewState === 'ADMIN' ? 'text-red-500 font-medium' : 'text-gray-500'}`}>
               <ShieldAlert size={14} /> /admin
             </button>
          )}
        </div>

        <div className="flex items-center gap-4">
          <button 
            onClick={toggleTheme} 
            className="text-gray-500 hover:text-emerald-600 dark:text-gray-400 dark:hover:text-white transition-colors p-1"
            aria-label="Alternar Tema Escuro"
          >
             {theme === 'dark' ? <Sun size={20} /> : <Moon size={20} />}
          </button>
          
          {/* Mobile Menu Toggle */}
          <button 
            className="md:hidden text-gray-500 hover:text-emerald-600 dark:text-gray-400 dark:hover:text-white p-1"
            onClick={() => setMobileMenuOpen(true)}
          >
             <Menu size={24} />
          </button>

          <div className="hidden md:block w-px h-5 bg-gray-300 dark:bg-gray-700"></div>
          
          {/* Desktop Auth */}
          <div className="hidden md:block">
            {user ? (
              <div className="flex items-center gap-3">
                 <span className="hidden sm:inline-block text-xs font-mono text-emerald-600 dark:text-emerald-500">
                    {userProfile?.username || user.email?.split('@')[0]}
                 </span>
                 <button 
                   onClick={handleLogout}
                   className="flex items-center gap-2 text-xs font-mono bg-gray-100 dark:bg-gray-800 px-3 py-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300"
                 >
                   <LogOut size={14} />
                   Sair
                 </button>
              </div>
            ) : (
              <button 
                onClick={() => setShowAuthModal(true)}
                className="flex items-center gap-2 text-xs font-mono bg-emerald-600 text-white px-3 py-1.5 rounded hover:bg-emerald-500 transition-colors shadow-lg shadow-emerald-900/20"
              >
                <LogIn size={14} />
                Entrar
              </button>
            )}
          </div>
        </div>
      </nav>

      {/* Mobile Menu Overlay */}
      {mobileMenuOpen && (
        <div className="fixed inset-0 z-[100] md:hidden">
           {/* Backdrop */}
           <div 
             className="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity duration-300"
             onClick={() => setMobileMenuOpen(false)}
           ></div>
           
           {/* Slide-out Panel */}
           <div className="absolute right-0 top-0 h-full w-[80%] max-w-sm bg-white dark:bg-[#0b0e11] border-l border-gray-200 dark:border-emerald-500/20 shadow-2xl flex flex-col p-6 animate-in slide-in-from-right duration-300">
              {/* Header */}
              <div className="flex items-center justify-between mb-8 border-b border-gray-100 dark:border-white/5 pb-4">
                 <div className="flex items-center gap-2 font-mono text-emerald-600 dark:text-emerald-500 text-sm">
                    <Terminal size={16} />
                    <span>system_nav.sh</span>
                 </div>
                 <button 
                   onClick={() => setMobileMenuOpen(false)}
                   className="text-gray-500 hover:text-emerald-500 transition-colors"
                 >
                    <X size={24} />
                 </button>
              </div>

              {/* User Info (Mobile) */}
              {user && (
                 <div className="mb-6 p-4 bg-gray-50 dark:bg-emerald-900/10 rounded-lg border border-gray-100 dark:border-emerald-500/20">
                    <div className="flex items-center gap-3 mb-2">
                       <div className="w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-600 dark:text-emerald-400">
                          <User size={20} />
                       </div>
                       <div className="overflow-hidden">
                          <p className="text-sm font-bold text-gray-900 dark:text-white truncate">@{userProfile?.username || 'user'}</p>
                          <p className="text-xs text-gray-500 font-mono truncate">{user.email}</p>
                       </div>
                    </div>
                 </div>
              )}

              {/* Navigation Links */}
              <div className="flex-1 flex flex-col gap-2 font-mono text-sm">
                 <button 
                   onClick={() => handleNavigation('HOME')} 
                   className={`text-left px-4 py-3 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${viewState === 'HOME' ? 'text-emerald-600 dark:text-emerald-500 bg-emerald-50 dark:bg-emerald-900/10 font-bold border-l-2 border-emerald-500' : 'text-gray-600 dark:text-gray-400'}`}
                 >
                    /posts
                 </button>
                 <button 
                   onClick={() => handleNavigation('SUBSCRIBE')} 
                   className={`text-left px-4 py-3 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${viewState === 'SUBSCRIBE' ? 'text-emerald-600 dark:text-emerald-500 bg-emerald-50 dark:bg-emerald-900/10 font-bold border-l-2 border-emerald-500' : 'text-gray-600 dark:text-gray-400'}`}
                 >
                    /assinar
                 </button>
                 <button 
                   onClick={() => handleNavigation('ABOUT')} 
                   className={`text-left px-4 py-3 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${viewState === 'ABOUT' ? 'text-emerald-600 dark:text-emerald-500 bg-emerald-50 dark:bg-emerald-900/10 font-bold border-l-2 border-emerald-500' : 'text-gray-600 dark:text-gray-400'}`}
                 >
                    /sobre
                 </button>

                 {userProfile?.role === 'admin' && (
                    <button 
                      onClick={() => handleNavigation('ADMIN')} 
                      className={`text-left px-4 py-3 rounded hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors mt-4 border border-red-200 dark:border-red-900/30 ${viewState === 'ADMIN' ? 'text-red-600 dark:text-red-400 font-bold' : 'text-red-500'}`}
                    >
                       <div className="flex items-center gap-2">
                          <ShieldAlert size={14} /> /admin_console
                       </div>
                    </button>
                 )}
              </div>

              {/* Footer Actions */}
              <div className="mt-auto pt-6 border-t border-gray-100 dark:border-white/5">
                 {user ? (
                    <button 
                      onClick={handleLogout}
                      className="w-full flex items-center justify-center gap-2 py-3 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors font-mono text-sm font-medium"
                    >
                       <LogOut size={16} /> Encerrar Sessão
                    </button>
                 ) : (
                    <button 
                      onClick={() => {
                         setMobileMenuOpen(false);
                         setShowAuthModal(true);
                      }}
                      className="w-full flex items-center justify-center gap-2 py-3 bg-emerald-600 text-white rounded hover:bg-emerald-500 transition-colors font-mono text-sm font-bold shadow-lg shadow-emerald-900/20"
                    >
                       <LogIn size={16} /> Iniciar Sessão
                    </button>
                 )}
                 <div className="mt-6 text-center text-[10px] text-gray-400 font-mono">
                    Runtime::Log v2.0.4 mobile_build
                 </div>
              </div>
           </div>
        </div>
      )}

      {/* Main Content */}
      <main className="relative pt-16 min-h-screen flex flex-col">
        
        {viewState === 'HOME' && (
          <>
            <Hero onSubscribe={() => handleNavigation('SUBSCRIBE')} />
            
            <div className="max-w-7xl mx-auto px-4 w-full pb-20">
              
              {/* Filter Section */}
              <div className="mb-12 space-y-4">
                
                {/* Top Row: Categories & Search */}
                <div className="flex flex-col md:flex-row md:items-center justify-between gap-6">
                  {/* Category Filter */}
                  <div className="flex overflow-x-auto gap-2 pb-2 md:pb-0 scrollbar-hide">
                    <button 
                      onClick={() => setActiveCategory('all')}
                      className={`px-4 py-2 rounded-full text-sm font-mono transition-all whitespace-nowrap border ${activeCategory === 'all' 
                        ? 'bg-emerald-600 text-white border-emerald-600 shadow-lg shadow-emerald-500/20' 
                        : 'bg-white dark:bg-[#0b0e11] text-gray-600 dark:text-gray-400 border-gray-200 dark:border-gray-800 hover:border-emerald-500/50'}`}
                    >
                      Todos os Sistemas
                    </button>
                    {availableCategories.map(cat => (
                      <button 
                        key={cat}
                        onClick={() => setActiveCategory(cat)}
                        className={`px-4 py-2 rounded-full text-sm font-mono transition-all whitespace-nowrap border ${activeCategory === cat
                          ? 'bg-emerald-600 text-white border-emerald-600 shadow-lg shadow-emerald-500/20' 
                          : 'bg-white dark:bg-[#0b0e11] text-gray-600 dark:text-gray-400 border-gray-200 dark:border-gray-800 hover:border-emerald-500/50'}`}
                      >
                        {cat}
                      </button>
                    ))}
                  </div>

                  {/* Search */}
                  <form onSubmit={handleSearch} className="relative w-full md:w-64 flex-shrink-0">
                     <div className="relative group">
                       <Search className="absolute left-3 top-2.5 text-gray-400 group-focus-within:text-emerald-500 transition-colors" size={16} />
                       <input 
                         type="text" 
                         placeholder="grep 'termo_busca'" 
                         value={searchQuery}
                         onChange={(e) => setSearchQuery(e.target.value)}
                         className="w-full bg-white dark:bg-[#0b0e11] border border-gray-200 dark:border-gray-800 rounded-lg py-2 pl-10 pr-4 text-sm font-mono focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500/20 transition-all text-gray-900 dark:text-white"
                       />
                     </div>
                  </form>
                </div>

                {/* Bottom Row: Subcategories (Dynamic) */}
                {availableSubcategories.length > 0 && (
                  <div className="flex items-center gap-3 animate-in fade-in slide-in-from-top-1">
                    <div className="flex items-center gap-1.5 text-xs font-mono text-gray-400 uppercase tracking-wider">
                      <Layers size={12} className="text-emerald-500" />
                      <span className="hidden sm:inline">Subcategorias:</span>
                    </div>
                    <div className="flex overflow-x-auto gap-2 pb-2 md:pb-0 scrollbar-hide flex-1">
                       <button
                          onClick={() => setActiveSubcategory('all')}
                          className={`px-3 py-1 rounded text-xs font-mono transition-all whitespace-nowrap border ${activeSubcategory === 'all'
                            ? 'bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/30'
                            : 'bg-transparent text-gray-500 border-transparent hover:text-emerald-500 hover:bg-emerald-500/5'
                          }`}
                       >
                         Todas
                       </button>
                       {availableSubcategories.map(sub => (
                          <button
                            key={sub}
                            onClick={() => setActiveSubcategory(sub)}
                            className={`px-3 py-1 rounded text-xs font-mono transition-all whitespace-nowrap border ${activeSubcategory === sub
                              ? 'bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/30'
                              : 'bg-transparent text-gray-500 border-transparent hover:text-emerald-500 hover:bg-emerald-500/5'
                            }`}
                          >
                            {sub}
                          </button>
                       ))}
                    </div>
                  </div>
                )}
              </div>

              {/* AI Insight Box (Visible only when searching) */}
              {searchQuery.length > 2 && searchInsight && (
                  <div className="mb-12 animate-in fade-in slide-in-from-top-4 duration-500">
                    <WindowFrame title="insight_ia.log" className="bg-gradient-to-r from-emerald-500/5 to-transparent border-emerald-500/20">
                        <div className="p-4 flex gap-4 items-start">
                             <div className="p-2 bg-emerald-500/10 rounded-lg text-emerald-600 dark:text-emerald-400">
                                <Sparkles size={20} />
                             </div>
                             <div>
                                <h4 className="text-xs font-mono text-emerald-600 dark:text-emerald-500 mb-1 uppercase tracking-wider">Análise Neural</h4>
                                <p className="text-sm text-gray-700 dark:text-gray-300 font-mono leading-relaxed">
                                   "{searchInsight}"
                                </p>
                             </div>
                        </div>
                    </WindowFrame>
                  </div>
              )}

              {/* Blog Grid */}
              {loadingPosts ? (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                  {[1, 2, 3, 4, 5, 6].map(i => (
                    <div key={i} className="h-64 rounded-lg bg-gray-200 dark:bg-[#111] animate-pulse"></div>
                  ))}
                </div>
              ) : (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                  {filteredPosts.map((post) => (
                    <div 
                      key={post.id}
                      onClick={() => handlePostClick(post)}
                      className="group relative bg-white dark:bg-[#0b0e11] border border-gray-200 dark:border-gray-800 rounded-lg overflow-hidden hover:border-emerald-500/50 transition-all duration-300 cursor-pointer flex flex-col h-full shadow-sm hover:shadow-xl hover:shadow-emerald-900/10 hover:-translate-y-1"
                    >
                      {/* Top Bar Decoration */}
                      <div className="h-1 w-full bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-800 dark:to-gray-700 group-hover:from-emerald-500 group-hover:to-teal-500 transition-all duration-300"></div>
                      
                      <div className="p-6 flex flex-col flex-grow">
                        <div className="flex justify-between items-start mb-4">
                          <div className="flex items-center gap-2">
                              <span className="text-xs font-mono text-emerald-600 dark:text-emerald-500 px-2 py-1 bg-emerald-50 dark:bg-emerald-900/10 rounded border border-emerald-500/10">
                                {post.category}
                              </span>
                              {post.subcategory && (
                                <span className="text-[10px] font-mono text-gray-500 dark:text-gray-400 flex items-center gap-1">
                                  <ChevronRight size={10} /> {post.subcategory}
                                </span>
                              )}
                          </div>
                          <span className="text-xs text-gray-400 font-mono">{post.date}</span>
                        </div>
                        
                        <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-3 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors line-clamp-2">
                          {post.title}
                        </h3>
                        
                        <p className="text-gray-600 dark:text-gray-400 text-sm leading-relaxed mb-6 line-clamp-3 flex-grow">
                          {post.excerpt}
                        </p>
                        
                        <div className="flex items-center justify-between mt-auto pt-4 border-t border-gray-100 dark:border-gray-800/50">
                          <span className="text-xs text-gray-500 font-mono flex items-center gap-1">
                             <Cpu size={12} /> {post.readTime}
                          </span>
                          <span className="text-sm font-bold text-gray-900 dark:text-white flex items-center gap-1 group-hover:translate-x-1 transition-transform">
                            Ler <ChevronRight size={16} className="text-emerald-500" />
                          </span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {!loadingPosts && filteredPosts.length === 0 && (
                <div className="text-center py-20">
                  <div className="inline-block p-4 rounded-full bg-gray-100 dark:bg-[#111] text-gray-400 mb-4">
                     <Filter size={32} />
                  </div>
                  <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-2">Nenhum dado encontrado</h3>
                  <p className="text-gray-500 font-mono">
                    Nenhum post corresponde aos filtros de Categoria/Subcategoria selecionados.
                  </p>
                  <button 
                    onClick={() => { setActiveCategory('all'); setSearchQuery(''); }}
                    className="mt-4 text-emerald-600 dark:text-emerald-500 text-sm font-mono underline"
                  >
                    Limpar filtros
                  </button>
                </div>
              )}
            </div>
          </>
        )}

        {viewState === 'ARTICLE' && selectedPost && (
          <ArticleView 
            post={selectedPost} 
            user={user}
            onAuthRequest={() => setShowAuthModal(true)}
            onBack={handleBack}
            previousPost={previousPost}
            nextPost={nextPost}
            onNavigate={handlePostClick}
          />
        )}

        {viewState === 'SUBSCRIBE' && <SubscribeView />}
        
        {viewState === 'ABOUT' && <AboutView />}

        {viewState === 'ADMIN' && <AdminView user={user} />}

      </main>

      {/* Footer */}
      <footer className="bg-white dark:bg-[#050505] border-t border-gray-200 dark:border-white/5 py-12 relative z-10">
        <div className="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-6">
           <div className="flex items-center gap-2 font-mono text-sm text-gray-500">
              <div className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
              Status do Sistema: Operacional
           </div>
           <div className="text-gray-500 text-sm font-mono text-center md:text-right">
              © 2024 CodeOmar. Todos os processos encerrados com sucesso.
           </div>
        </div>
      </footer>
    </div>
  );
};

export default App;

========================================
Arquivo: components/AdminView.tsx
========================================

import React, { useState, useRef, useEffect } from 'react';
import { supabase } from '../services/supabaseClient';
import { generateFullPost } from '../services/geminiService';
import WindowFrame from './WindowFrame';
import { UploadCloud, FileText, Loader, X, Bot, PenTool, Save, Trash2, Sparkles, AlertTriangle, Eye, CheckCircle, Edit, RefreshCw, Search, ArrowLeft, Plus, History, RotateCcw, Layers } from 'lucide-react';
import { CATEGORIES } from '../constants';
import ArticleView from './ArticleView';
import { BlogPost } from '../types';

interface AdminViewProps {
  user: any;
}

const AdminView: React.FC<AdminViewProps> = ({ user }) => {
  // Mode: 'create' | 'edit-list' | 'edit-form'
  const [viewMode, setViewMode] = useState<'create' | 'edit-list' | 'edit-form'>('create');
  
  // Form State
  const [title, setTitle] = useState('');
  const [slug, setSlug] = useState('');
  const [excerpt, setExcerpt] = useState('');
  const [content, setContent] = useState('');
  
  // Category & Subcategory State
  const [category, setCategory] = useState(CATEGORIES[0].name);
  const [isCustomCategory, setIsCustomCategory] = useState(false);
  const [subcategory, setSubcategory] = useState('');
  
  const [tags, setTags] = useState<string[]>([]);
  const [currentTag, setCurrentTag] = useState('');
  const [readTime, setReadTime] = useState('5 min leitura');
  const [status, setStatus] = useState<'draft' | 'published'>('draft');

  // Edit Mode State
  const [editingPostId, setEditingPostId] = useState<string | null>(null);
  const [postList, setPostList] = useState<any[]>([]);
  const [loadingList, setLoadingList] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');

  // AI & Processing State
  const [isGenerating, setIsGenerating] = useState(false);
  const [aiTopic, setAiTopic] = useState('');
  const [uploading, setUploading] = useState(false);
  const [previewMode, setPreviewMode] = useState(false);
  const [saveStatus, setSaveStatus] = useState<'idle' | 'saving' | 'success' | 'error'>('idle');
  const fileInputRef = useRef<HTMLInputElement>(null);

  // Autosave State
  const [lastAutosaved, setLastAutosaved] = useState<Date | null>(null);
  const [hasLocalDraft, setHasLocalDraft] = useState(false);

  // --- Autosave Logic ---

  const getStorageKey = () => {
    return editingPostId ? `autosave_draft_${editingPostId}` : 'autosave_draft_new';
  };

  // Check for existing draft on mount or mode switch
  useEffect(() => {
    const key = getStorageKey();
    const saved = localStorage.getItem(key);
    if (saved) {
      // Don't flag if the saved content is identical to initial empty state (for new posts)
      const parsed = JSON.parse(saved);
      const isNotEmpty = parsed.title || parsed.content || parsed.slug;
      if (isNotEmpty) {
        setHasLocalDraft(true);
      }
    } else {
      setHasLocalDraft(false);
    }
  }, [viewMode, editingPostId]);

  // Autosave Interval (30s)
  useEffect(() => {
    if (viewMode === 'edit-list') return;

    const interval = setInterval(() => {
      // Only autosave if there is some content
      if (!title && !content && !slug) return;

      const draftData = {
        title,
        slug,
        excerpt,
        content,
        category,
        isCustomCategory,
        subcategory,
        tags,
        readTime,
        status,
        timestamp: new Date().toISOString()
      };

      localStorage.setItem(getStorageKey(), JSON.stringify(draftData));
      setLastAutosaved(new Date());
    }, 30000);

    return () => clearInterval(interval);
  }, [title, slug, excerpt, content, category, isCustomCategory, subcategory, tags, readTime, status, viewMode, editingPostId]);

  const handleRestoreDraft = () => {
    try {
      const key = getStorageKey();
      const saved = localStorage.getItem(key);
      if (!saved) return;

      const data = JSON.parse(saved);
      setTitle(data.title || '');
      setSlug(data.slug || '');
      setExcerpt(data.excerpt || '');
      setContent(data.content || '');
      
      setCategory(data.category || CATEGORIES[0].name);
      setIsCustomCategory(data.isCustomCategory || false);
      setSubcategory(data.subcategory || '');

      setTags(data.tags || []);
      setReadTime(data.readTime || '5 min leitura');
      setStatus(data.status || 'draft');
      
      setHasLocalDraft(false); // Hide banner after restore
      alert("Rascunho restaurado do armazenamento local.");
    } catch (e) {
      console.error("Falha ao restaurar rascunho", e);
    }
  };

  const clearLocalDraft = () => {
    localStorage.removeItem(getStorageKey());
    setHasLocalDraft(false);
    setLastAutosaved(null);
  };

  // --- End Autosave Logic ---

  // Fetch posts when entering list view
  useEffect(() => {
    if (viewMode === 'edit-list') {
      fetchPostList();
    }
  }, [viewMode]);

  const fetchPostList = async () => {
    setLoadingList(true);
    try {
      const { data, error } = await supabase
        .from('posts')
        .select('id, title, status, created_at, category, subcategory, slug')
        .order('created_at', { ascending: false });
      
      if (error) throw error;
      setPostList(data || []);
    } catch (err) {
      console.error('Erro ao buscar posts:', err);
    } finally {
      setLoadingList(false);
    }
  };

  const handleEditSelect = async (postId: string) => {
    setSaveStatus('idle');
    setHasLocalDraft(false); // Reset before loading new context
    setLastAutosaved(null);
    
    try {
      const { data, error } = await supabase
        .from('posts')
        .select('*')
        .eq('id', postId)
        .single();
        
      if (error) throw error;
      if (data) {
        setEditingPostId(data.id);
        setTitle(data.title);
        setSlug(data.slug);
        setExcerpt(data.excerpt || '');
        setContent(data.content || '');
        
        // Handle Category logic (Predefined vs Custom)
        const isPredefined = CATEGORIES.some(c => c.name === data.category);
        setCategory(data.category);
        setIsCustomCategory(!isPredefined);
        setSubcategory(data.subcategory || '');
        
        setTags(data.tags || []);
        setReadTime(data.read_time);
        setStatus(data.status);
        setViewMode('edit-form');
      }
    } catch (err) {
      console.error("Erro ao carregar detalhes do post:", err);
      alert("Falha ao carregar post.");
    }
  };

  const handleDeletePost = async (postId: string, postTitle: string) => {
    if (!window.confirm(`Tem certeza que deseja excluir "${postTitle}"? Isso não pode ser desfeito.`)) {
      return;
    }

    try {
      const { error } = await supabase.from('posts').delete().eq('id', postId);
      if (error) throw error;
      
      // Clear autosave if deleting the currently edited post
      localStorage.removeItem(`autosave_draft_${postId}`);
      
      fetchPostList(); // Refresh list
    } catch (err) {
      console.error("Erro ao deletar post:", err);
      alert("Falha ao deletar post.");
    }
  };

  const resetForm = () => {
    setTitle('');
    setSlug('');
    setExcerpt('');
    setContent('');
    setCategory(CATEGORIES[0].name);
    setIsCustomCategory(false);
    setSubcategory('');
    setTags([]);
    setReadTime('5 min leitura');
    setStatus('draft');
    setEditingPostId(null);
    setSaveStatus('idle');
    setLastAutosaved(null);
    setHasLocalDraft(false);
  };

  const handleCreateNew = () => {
    resetForm();
    setViewMode('create');
  };

  const handleGenerateAI = async () => {
    if (!aiTopic) return;
    setIsGenerating(true);
    try {
      const generated = await generateFullPost(aiTopic);
      setTitle(generated.title);
      setSlug(generated.slug);
      setExcerpt(generated.excerpt);
      setContent(generated.content);
      
      // Basic category matching, fallback to what was generated
      const generatedCat = generated.category || CATEGORIES[0].name;
      const isPredefined = CATEGORIES.some(c => c.name === generatedCat);
      setCategory(generatedCat);
      setIsCustomCategory(!isPredefined);
      // AI usually doesn't generate subcategory in our current prompt, but we can clear it or set if added
      setSubcategory(''); 

      setTags(generated.tags || []);
      setReadTime(generated.read_time || '5 min leitura');
    } catch (error) {
      console.error(error);
      alert("Falha ao gerar conteúdo. Verifique sua API Key.");
    } finally {
      setIsGenerating(false);
    }
  };

  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    setUploading(true);
    const reader = new FileReader();
    reader.onload = async (event) => {
      const text = event.target?.result as string;
      // Simple Frontmatter parser (naïve implementation)
      // Expects --- \n key: value \n ---
      const frontmatterRegex = /^---\n([\s\S]*?)\n---\n([\s\S]*)$/;
      const match = text.match(frontmatterRegex);

      if (match) {
        const yaml = match[1];
        const body = match[2];
        setContent(body.trim());
        
        // Parse basic yaml keys
        const titleMatch = yaml.match(/title:\s*(.*)/);
        if (titleMatch) setTitle(titleMatch[1].replace(/['"]/g, '').trim());
        
        const slugMatch = yaml.match(/slug:\s*(.*)/);
        if (slugMatch) setSlug(slugMatch[1].trim());

        const excerptMatch = yaml.match(/excerpt:\s*(.*)/);
        if (excerptMatch) setExcerpt(excerptMatch[1].trim());

        const subcatMatch = yaml.match(/subcategory:\s*(.*)/);
        if (subcatMatch) setSubcategory(subcatMatch[1].trim());
      } else {
        // Assume raw markdown
        setContent(text);
        setTitle(file.name.replace('.md', ''));
      }
      setUploading(false);
    };
    reader.readAsText(file);
  };

  const handleSave = async () => {
    if (!title || !slug || !user) {
      alert("Título, Slug e Autenticação de Usuário são obrigatórios.");
      return;
    }
    
    setSaveStatus('saving');
    
    const postData = {
      title,
      slug,
      excerpt,
      content,
      category,
      subcategory: subcategory || null,
      tags,
      read_time: readTime,
      status,
      author_id: user.id,
      updated_at: new Date().toISOString()
    };

    try {
      if (editingPostId) {
        // UPDATE
        const { error } = await supabase
          .from('posts')
          .update(postData)
          .eq('id', editingPostId);
        if (error) throw error;
      } else {
        // INSERT
        const { error } = await supabase
          .from('posts')
          .insert([postData]);
        if (error) throw error;
      }
      
      setSaveStatus('success');
      clearLocalDraft(); // Clear autosave on successful commit
      setTimeout(() => setSaveStatus('idle'), 2000);
    } catch (error: any) {
      console.error(error);
      setSaveStatus('error');
      alert(`Erro ao salvar: ${error.message}`);
    }
  };

  const handleAddTag = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && currentTag) {
      e.preventDefault();
      if (!tags.includes(currentTag)) {
        setTags([...tags, currentTag]);
      }
      setCurrentTag('');
    }
  };

  const removeTag = (tag: string) => {
    setTags(tags.filter(t => t !== tag));
  };

  // Preview Object
  const previewPost: BlogPost = {
    id: 'preview',
    title: title || 'Post Sem Título',
    excerpt: excerpt || 'Nenhum resumo fornecido...',
    content: content || '',
    category: category,
    subcategory: subcategory,
    readTime: readTime,
    date: new Date().toLocaleDateString('pt-BR'),
    tags: tags,
    slug: slug,
    status: status
  };

  if (previewMode) {
    return (
      <ArticleView 
        post={previewPost} 
        user={user} 
        onAuthRequest={() => {}} 
        onBack={() => setPreviewMode(false)}
        previewMode={true}
      />
    );
  }

  const renderPostList = () => {
    const filtered = postList.filter(p => p.title.toLowerCase().includes(searchTerm.toLowerCase()));

    return (
      <div className="space-y-4">
        <div className="flex gap-4 mb-6">
          <div className="relative flex-1">
             <Search className="absolute left-3 top-2.5 text-gray-400" size={16} />
             <input 
               type="text"
               placeholder="Buscar posts..."
               value={searchTerm}
               onChange={(e) => setSearchTerm(e.target.value)}
               className="w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg text-sm font-mono focus:outline-none focus:border-emerald-500 transition-colors"
             />
          </div>
          <button onClick={fetchPostList} className="p-2 bg-gray-100 dark:bg-gray-800 rounded-lg hover:text-emerald-500 transition-colors">
            <RefreshCw size={18} className={loadingList ? 'animate-spin' : ''} />
          </button>
        </div>

        <div className="bg-white dark:bg-[#0b0e11] border border-gray-200 dark:border-gray-800 rounded-lg overflow-hidden">
           <table className="w-full text-sm text-left">
             <thead className="text-xs text-gray-500 uppercase bg-gray-50 dark:bg-[#15191e] border-b border-gray-200 dark:border-gray-800">
               <tr>
                 <th className="px-6 py-3 font-mono">Título</th>
                 <th className="px-6 py-3 font-mono">Categoria</th>
                 <th className="px-6 py-3 font-mono">Status</th>
                 <th className="px-6 py-3 font-mono">Data</th>
                 <th className="px-6 py-3 font-mono text-right">Ações</th>
               </tr>
             </thead>
             <tbody>
               {loadingList ? (
                 <tr><td colSpan={5} className="p-6 text-center"><Loader className="animate-spin mx-auto text-emerald-500" /></td></tr>
               ) : filtered.length === 0 ? (
                 <tr><td colSpan={5} className="p-6 text-center text-gray-500 font-mono">Nenhum post encontrado.</td></tr>
               ) : (
                 filtered.map(post => (
                   <tr key={post.id} className="border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-[#15191e]/50 transition-colors">
                     <td className="px-6 py-4 font-medium text-gray-900 dark:text-gray-200 truncate max-w-xs">{post.title}</td>
                     <td className="px-6 py-4 font-mono text-xs text-gray-500">
                        {post.category} 
                        {post.subcategory && <span className="text-emerald-600 dark:text-emerald-500"> / {post.subcategory}</span>}
                     </td>
                     <td className="px-6 py-4">
                       <span className={`px-2 py-1 rounded text-xs font-mono border ${
                         post.status === 'published' 
                          ? 'bg-emerald-50 dark:bg-emerald-900/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/20' 
                          : 'bg-yellow-50 dark:bg-yellow-900/10 text-yellow-600 dark:text-yellow-400 border-yellow-500/20'
                       }`}>
                         {post.status}
                       </span>
                     </td>
                     <td className="px-6 py-4 text-gray-500 font-mono text-xs">
                       {new Date(post.created_at).toLocaleDateString('pt-BR')}
                     </td>
                     <td className="px-6 py-4 text-right space-x-2">
                       <button 
                         onClick={() => handleEditSelect(post.id)}
                         className="p-1.5 text-gray-500 hover:text-emerald-500 transition-colors"
                         title="Editar"
                       >
                         <Edit size={16} />
                       </button>
                       <button 
                         onClick={() => handleDeletePost(post.id, post.title)}
                         className="p-1.5 text-gray-500 hover:text-red-500 transition-colors"
                         title="Excluir"
                       >
                         <Trash2 size={16} />
                       </button>
                     </td>
                   </tr>
                 ))
               )}
             </tbody>
           </table>
        </div>
      </div>
    );
  };

  const renderForm = () => (
    <>
      {hasLocalDraft && (
         <div className="mb-6 p-4 bg-amber-50 dark:bg-amber-900/10 border border-amber-200 dark:border-amber-500/20 rounded-lg flex items-center justify-between animate-in slide-in-from-top-2">
           <div className="flex items-center gap-3">
             <div className="p-2 bg-amber-100 dark:bg-amber-900/30 rounded-full text-amber-600 dark:text-amber-500">
               <History size={16} />
             </div>
             <div>
               <h4 className="text-xs font-bold text-amber-800 dark:text-amber-500 font-mono uppercase">Rascunho Não Salvo Detectado</h4>
               <p className="text-sm text-amber-700 dark:text-amber-400/80">
                 Encontrei uma versão local mais recente {viewMode === 'create' ? 'de um novo post' : 'deste post'}.
               </p>
             </div>
           </div>
           <div className="flex gap-2">
             <button 
               onClick={clearLocalDraft}
               className="px-3 py-1.5 text-xs font-mono text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors"
             >
               Descartar
             </button>
             <button 
               onClick={handleRestoreDraft}
               className="px-3 py-1.5 bg-amber-500 hover:bg-amber-600 text-white rounded text-xs font-mono flex items-center gap-1 transition-colors shadow-sm"
             >
               <RotateCcw size={12} />
               Restaurar
             </button>
           </div>
         </div>
      )}

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
        {/* Left Column: Input Fields */}
        <div className="lg:col-span-2 space-y-6">
          <div className="space-y-4">
            <div>
              <label className="block text-xs font-mono text-gray-500 mb-1 uppercase">Título</label>
              <input 
                value={title}
                onChange={(e) => setTitle(e.target.value)}
                className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg p-3 text-sm font-mono focus:outline-none focus:border-emerald-500 transition-colors dark:text-white"
                placeholder="Ex: Entendendo React Fiber"
              />
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-xs font-mono text-gray-500 mb-1 uppercase">Slug</label>
                <input 
                  value={slug}
                  onChange={(e) => setSlug(e.target.value)}
                  className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg p-3 text-sm font-mono focus:outline-none focus:border-emerald-500 transition-colors dark:text-white"
                  placeholder="ex: react-fiber-deep-dive"
                />
              </div>
              
              {/* Category Selection Area */}
              <div>
                 <div className="flex justify-between items-center mb-1">
                   <label className="block text-xs font-mono text-gray-500 uppercase">Categoria</label>
                   <button 
                      onClick={() => {
                        setIsCustomCategory(!isCustomCategory);
                        // Reset to default if switching back to dropdown
                        if (isCustomCategory) setCategory(CATEGORIES[0].name);
                        else setCategory('');
                      }}
                      className="text-[10px] font-mono text-emerald-600 dark:text-emerald-500 hover:underline cursor-pointer"
                   >
                     {isCustomCategory ? "Usar Existente" : "Criar Nova"}
                   </button>
                 </div>
                 
                 {isCustomCategory ? (
                   <input 
                     value={category}
                     onChange={(e) => setCategory(e.target.value)}
                     className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg p-3 text-sm font-mono focus:outline-none focus:border-emerald-500 transition-colors dark:text-white"
                     placeholder="Nome da Nova Categoria"
                   />
                 ) : (
                   <select 
                     value={category}
                     onChange={(e) => setCategory(e.target.value)}
                     className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg p-3 text-sm font-mono focus:outline-none focus:border-emerald-500 transition-colors dark:text-white"
                   >
                     {CATEGORIES.map(cat => (
                       <option key={cat.id} value={cat.name}>{cat.name}</option>
                     ))}
                   </select>
                 )}
              </div>
            </div>

            {/* Subcategory (New Feature) */}
            <div>
              <label className="block text-xs font-mono text-gray-500 mb-1 uppercase flex items-center gap-1">
                 <Layers size={12} /> Subcategoria (Opcional)
              </label>
              <input 
                value={subcategory}
                onChange={(e) => setSubcategory(e.target.value)}
                className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg p-3 text-sm font-mono focus:outline-none focus:border-emerald-500 transition-colors dark:text-white"
                placeholder="Ex: Database, Hooks, AWS"
              />
            </div>

            <div>
              <label className="block text-xs font-mono text-gray-500 mb-1 uppercase">Resumo (Excerpt)</label>
              <textarea 
                value={excerpt}
                onChange={(e) => setExcerpt(e.target.value)}
                rows={2}
                className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg p-3 text-sm font-mono focus:outline-none focus:border-emerald-500 transition-colors dark:text-white"
                placeholder="Breve resumo para os cartões..."
              />
            </div>

            <div className="relative">
              <div className="flex justify-between items-center mb-1">
                <label className="block text-xs font-mono text-gray-500 uppercase">Conteúdo (Markdown)</label>
                <button 
                  onClick={() => fileInputRef.current?.click()}
                  className="text-xs flex items-center gap-1 text-emerald-600 hover:text-emerald-500 font-mono"
                  disabled={uploading}
                >
                  {uploading ? <Loader size={12} className="animate-spin" /> : <UploadCloud size={12} />}
                  Importar .md
                </button>
                <input 
                  type="file" 
                  ref={fileInputRef} 
                  className="hidden" 
                  accept=".md,.markdown,.txt" 
                  onChange={handleFileUpload}
                />
              </div>
              {/* IMPROVED STYLING: padding-6, leading-7, tracking-wide */}
              <textarea 
                value={content}
                onChange={(e) => setContent(e.target.value)}
                rows={25}
                className="w-full bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 rounded-lg p-6 text-sm font-mono leading-7 tracking-wide focus:outline-none focus:border-emerald-500 transition-colors dark:text-white resize-y shadow-inner"
                style={{ tabSize: 2 }}
                placeholder="# Olá Mundo..."
              />
            </div>
          </div>
        </div>

        {/* Right Column: Sidebar settings */}
        <div className="space-y-6">
           {/* AI Generator Box */}
           <div className="p-4 rounded-lg bg-gradient-to-br from-purple-900/10 to-emerald-900/10 border border-emerald-500/20">
              <div className="flex items-center gap-2 mb-3 text-emerald-600 dark:text-emerald-400 font-mono text-sm font-bold">
                <Bot size={16} />
                <span>Gerador de Rascunho IA</span>
              </div>
              <p className="text-xs text-gray-500 mb-3">Gere a estrutura completa do artigo usando Gemini 3.</p>
              <div className="flex gap-2">
                 <input 
                   value={aiTopic} 
                   onChange={(e) => setAiTopic(e.target.value)}
                   placeholder="Tópico..." 
                   className="flex-1 bg-white dark:bg-black/20 border border-gray-200 dark:border-gray-700 rounded px-2 py-1 text-xs font-mono dark:text-white"
                 />
                 <button 
                   onClick={handleGenerateAI}
                   disabled={isGenerating || !aiTopic}
                   className="bg-emerald-600 text-white p-2 rounded hover:bg-emerald-500 disabled:opacity-50"
                 >
                   {isGenerating ? <Loader className="animate-spin" size={14} /> : <Sparkles size={14} />}
                 </button>
              </div>
           </div>

           {/* Tags */}
           <div className="p-4 rounded-lg bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700">
              <label className="block text-xs font-mono text-gray-500 mb-2 uppercase">Tags</label>
              <div className="flex flex-wrap gap-2 mb-2">
                {tags.map(tag => (
                  <span key={tag} className="flex items-center gap-1 text-[10px] bg-emerald-500/10 text-emerald-600 px-2 py-1 rounded border border-emerald-500/20">
                    {tag}
                    <button onClick={() => removeTag(tag)} className="hover:text-red-500"><X size={10} /></button>
                  </span>
                ))}
              </div>
              <input 
                value={currentTag}
                onChange={(e) => setCurrentTag(e.target.value)}
                onKeyDown={handleAddTag}
                placeholder="Adicionar tag + Enter"
                className="w-full bg-transparent border-b border-gray-200 dark:border-gray-700 py-1 text-xs font-mono focus:outline-none focus:border-emerald-500 dark:text-white"
              />
           </div>

           {/* Meta */}
           <div className="p-4 rounded-lg bg-gray-50 dark:bg-[#15191e] border border-gray-200 dark:border-gray-700 space-y-4">
              <div>
                <label className="block text-xs font-mono text-gray-500 mb-1 uppercase">Tempo de Leitura</label>
                <input 
                   value={readTime}
                   onChange={(e) => setReadTime(e.target.value)}
                   className="w-full bg-white dark:bg-black/20 border border-gray-200 dark:border-gray-700 rounded px-2 py-1.5 text-xs font-mono dark:text-white"
                />
              </div>
              <div>
                <label className="block text-xs font-mono text-gray-500 mb-1 uppercase">Status</label>
                <select 
                  value={status}
                  onChange={(e) => setStatus(e.target.value as any)}
                  className="w-full bg-white dark:bg-black/20 border border-gray-200 dark:border-gray-700 rounded px-2 py-1.5 text-xs font-mono dark:text-white"
                >
                  <option value="draft">Rascunho</option>
                  <option value="published">Publicado</option>
                </select>
              </div>
           </div>

           {/* Actions */}
           <div className="flex flex-col gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
              {lastAutosaved && (
                <div className="text-[10px] text-gray-400 font-mono text-center flex items-center justify-center gap-1">
                   <CheckCircle size={10} className="text-emerald-500" />
                   Salvo autom. às {lastAutosaved.toLocaleTimeString()}
                </div>
              )}

              <button 
                onClick={() => setPreviewMode(true)}
                className="w-full flex items-center justify-center gap-2 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors font-mono text-xs font-bold"
              >
                <Eye size={14} /> Pré-visualizar
              </button>
              <button 
                onClick={handleSave}
                disabled={saveStatus === 'saving'}
                className="w-full flex items-center justify-center gap-2 py-2.5 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white transition-colors font-mono text-xs font-bold shadow-lg shadow-emerald-900/20 disabled:opacity-50"
              >
                {saveStatus === 'saving' ? <Loader className="animate-spin" size={14} /> : 
                 saveStatus === 'success' ? <CheckCircle size={14} /> :
                 saveStatus === 'error' ? <AlertTriangle size={14} /> :
                 <Save size={14} />}
                {saveStatus === 'saving' ? 'Salvando...' : 
                 saveStatus === 'success' ? 'Salvo!' : 
                 saveStatus === 'error' ? 'Erro' : 
                 'Salvar Post'}
              </button>
              {viewMode === 'edit-form' && (
                 <button 
                   onClick={() => setViewMode('edit-list')}
                   className="text-xs text-gray-500 hover:text-gray-400 font-mono text-center underline"
                 >
                   Cancelar Edição
                 </button>
              )}
           </div>
        </div>
      </div>
    </>
  );

  return (
    <div className="max-w-7xl mx-auto px-4 py-12">
      <div className="mb-8 flex items-center gap-2 text-gray-500 font-mono text-sm">
        <span>root</span>
        <span>/</span>
        <span className="text-emerald-600 dark:text-emerald-500">admin</span>
        <span>/</span>
        <span>console_cms</span>
      </div>

      <WindowFrame title={viewMode === 'edit-list' ? 'database_explorer.sql' : (viewMode === 'create' ? 'new_post_wizard.exe' : `edit_post_${editingPostId}.sh`)} className="shadow-2xl">
        <div className="p-6 md:p-8 bg-white dark:bg-[#0b0e11] min-h-[600px]">
          
          {/* Admin Navigation */}
          <div className="flex flex-col md:flex-row gap-4 mb-8 pb-8 border-b border-gray-200 dark:border-gray-800">
             <div className="flex gap-2 p-1 bg-gray-100 dark:bg-[#15191e] rounded-lg self-start">
               <button 
                 onClick={handleCreateNew}
                 className={`px-4 py-2 rounded-md text-sm font-mono flex items-center gap-2 transition-all ${viewMode === 'create' ? 'bg-white dark:bg-[#0b0e11] text-emerald-600 dark:text-emerald-500 shadow-sm' : 'text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'}`}
               >
                 <Plus size={16} /> Novo Post
               </button>
               <button 
                 onClick={() => setViewMode('edit-list')}
                 className={`px-4 py-2 rounded-md text-sm font-mono flex items-center gap-2 transition-all ${viewMode === 'edit-list' || viewMode === 'edit-form' ? 'bg-white dark:bg-[#0b0e11] text-emerald-600 dark:text-emerald-500 shadow-sm' : 'text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'}`}
               >
                 <PenTool size={16} /> Gerenciar Posts
               </button>
             </div>

             <div className="ml-auto text-right hidden md:block">
               <div className="text-xs font-mono text-gray-400">Autenticado como</div>
               <div className="text-sm font-bold text-gray-900 dark:text-white flex items-center gap-2 justify-end">
                  <div className="w-2 h-2 rounded-full bg-emerald-500"></div>
                  {user.email}
               </div>
             </div>
          </div>

          {/* Content Area */}
          <div className="animate-in fade-in duration-300">
            {viewMode === 'edit-list' ? renderPostList() : renderForm()}
          </div>

        </div>
      </WindowFrame>
    </div>
  );
};

export default AdminView;

